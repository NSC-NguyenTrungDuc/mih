package nta.med.data.dao.medi.res.impl;

import java.util.List;

import javax.persistence.EntityManager;
import javax.persistence.PersistenceContext;
import javax.persistence.Query;

import nta.med.core.infrastructure.mapper.JpaResultMapper;
import nta.med.data.dao.medi.res.Res0101RepositoryCustom;
import nta.med.data.model.ihis.drgs.DRG9001GetLay9001Info;
import nta.med.data.model.ihis.drgs.DRG9001R03lay9001RInfo;
import nta.med.data.model.ihis.drgs.DRG9001R04lay9001RInfo;

/**
 * @author dainguyen.
 */
public class Res0101RepositoryImpl implements Res0101RepositoryCustom {
	
	@PersistenceContext
	private EntityManager entityManager;
	
	@Override
	public List<DRG9001GetLay9001Info> getDRG9001R01GetLay9001Info(String hospCode, String date){
		StringBuilder sql = new StringBuilder();
		sql.append("SELECT DATE_FORMAT(E.HOLI_DAY, '%Y/%m/%d')                   AS HOLI_DAY                                       ");
		sql.append("     , IFNULL(A.SU, 0)                                       AS DRG_CNT                                        ");
		sql.append("     , IFNULL(G.SU, 0)                                       AS DRG_GROUP_CNT                                  ");
		sql.append("     , IFNULL(C.SU, 0)                                       AS DRG_HANGMOG_CNT                                ");
		sql.append("     , IFNULL(B.SU, 0)                                       AS INJ_CNT                                        ");
		sql.append("     , IFNULL(H.SU, 0)                                       AS INJ_GROUP_CNT                                  ");
		sql.append("     , IFNULL(D.SU, 0)                                       AS INJ_HANGMOG_CNT                                ");
		sql.append("     , IFNULL(A.SU, 0) + IFNULL(B.SU, 0)                     AS DRG_INJ_CNT                                    ");
		sql.append("     , IFNULL(G.SU, 0) + IFNULL(H.SU, 0)                     AS DRG_INJ_GROUP_CNT                              ");
		sql.append("     , IFNULL(C.SU, 0) + IFNULL(D.SU, 0)                     AS DRG_INJ_HANGMOG_CNT                            ");
		sql.append("  FROM RES0101 E LEFT OUTER JOIN (SELECT NAEWON_DATE , COUNT(*)  SU                                          ");
		sql.append("          FROM (                                                                                               ");
		sql.append("                SELECT DATE_FORMAT(X.NAEWON_DATE, '%Y/%m/%d') NAEWON_DATE, X.DRG_BUNHO, SUM(1)                                          ");
		sql.append("                  FROM DRG2010 X                                                                               ");
		sql.append("                 WHERE X.HOSP_CODE = :f_hosp_code                                                              ");
		sql.append("                   AND X.NAEWON_DATE BETWEEN STR_TO_DATE(CONCAT(:f_date,'01'),'%Y%m%d')                        ");
		sql.append("                                         AND LAST_DAY(STR_TO_DATE(:f_date,'%Y%m'))                             ");
		sql.append("                   AND X.BUNRYU1   <> '4'                                                                      ");
		sql.append("                   AND X.ACT_DATE  IS NOT NULL                                                                 ");
		sql.append("                   AND X.BUNHO     NOT LIKE '09%'                                                              ");
		sql.append("                   AND IFNULL(X.DC_YN, 'N')     = 'N'                                                          ");
		sql.append("                   AND IFNULL(X.BANNAB_YN, 'N') = 'N'                                                          ");
		sql.append("                 GROUP BY X.NAEWON_DATE, X.DRG_BUNHO                                                           ");
		sql.append("                ) W                                                                                            ");
		sql.append("         GROUP BY W.NAEWON_DATE ) A ON E.HOLI_DAY   = A.NAEWON_DATE                                            ");
		sql.append("                  LEFT OUTER JOIN (SELECT ACTING_DATE NAEWON_DATE, COUNT(*)  SU                                ");
		sql.append("          FROM (SELECT DATE_FORMAT(Z.ACTING_DATE, '%Y/%m/%d') ACTING_DATE, Z.BUNHO, SUM(1)                                                          ");
		sql.append("                  FROM OCS1003 Z                                                                               ");
		sql.append("                 WHERE Z.HOSP_CODE   = :f_hosp_code                                                            ");
		sql.append("                   AND Z.SLIP_CODE   LIKE 'J%'                                                                 ");
		sql.append("                   AND Z.ACTING_DATE BETWEEN STR_TO_DATE(CONCAT(:f_date,'01'),'%Y%m%d')                        ");
		sql.append("                                         AND LAST_DAY(STR_TO_DATE(:f_date,'%Y%m'))                             ");
		sql.append("                   AND Z.ACTING_DATE IS NOT NULL                                                               ");
		sql.append("                   AND Z.BUNHO       NOT LIKE '09%'                                                            ");
		sql.append("                   AND IFNULL(Z.DC_YN, 'N')     = 'N'                                                          ");
		sql.append("                   AND IFNULL(Z.BANNAB_YN, 'N') = 'N'                                                          ");
		sql.append("                 GROUP BY Z.ACTING_DATE, Z.BUNHO                                                               ");
		sql.append("                ) W                                                                                            ");
		sql.append("         GROUP BY W.ACTING_DATE) B ON E.HOLI_DAY = B.NAEWON_DATE                                               ");
		sql.append("                  LEFT OUTER JOIN (SELECT NAEWON_DATE , SUM(CNT)  SU                                           ");
		sql.append("          FROM (SELECT DATE_FORMAT(X.NAEWON_DATE, '%Y/%m/%d') NAEWON_DATE, COUNT(X.JAERYO_CODE) CNT                                     ");
		sql.append("                  FROM DRG2010 X                                                                               ");
		sql.append("                 WHERE X.HOSP_CODE = :f_hosp_code                                                              ");
		sql.append("                   AND X.NAEWON_DATE BETWEEN STR_TO_DATE(CONCAT(:f_date,'01'),'%Y%m%d')                        ");
		sql.append("                                         AND LAST_DAY(STR_TO_DATE(:f_date,'%Y%m'))                             ");
		sql.append("                   AND X.BUNRYU1   <> '4'                                                                      ");
		sql.append("                   AND X.ACT_DATE  IS NOT NULL                                                                 ");
		sql.append("                   AND X.BUNHO     NOT LIKE '09%'                                                              ");
		sql.append("                   AND IFNULL(X.DC_YN, 'N')     = 'N'                                                          ");
		sql.append("                   AND IFNULL(X.BANNAB_YN, 'N') = 'N'                                                          ");
		sql.append("                 GROUP BY X.NAEWON_DATE) W                                                                     ");
		sql.append("         GROUP BY W.NAEWON_DATE ) C ON E.HOLI_DAY = C.NAEWON_DATE                                              ");
		sql.append("                  LEFT OUTER JOIN (SELECT ACTING_DATE NAEWON_DATE, SUM(CNT)  SU                                ");
		sql.append("          FROM (SELECT DATE_FORMAT(Z.ACTING_DATE, '%Y/%m/%d') ACTING_DATE, COUNT(Z.HANGMOG_CODE) CNT                                                ");
		sql.append("                  FROM OCS1003 Z                                                                               ");
		sql.append("                 WHERE Z.HOSP_CODE   = :f_hosp_code                                                            ");
		sql.append("                   AND Z.SLIP_CODE   LIKE 'J%'                                                                 ");
		sql.append("                   AND Z.ACTING_DATE BETWEEN STR_TO_DATE(CONCAT(:f_date,'01'),'%Y%m%d')                        ");
		sql.append("                                         AND LAST_DAY(STR_TO_DATE(:f_date,'%Y%m'))                             ");
		sql.append("                   AND Z.ACTING_DATE IS NOT NULL                                                               ");
		sql.append("                   AND Z.BUNHO       NOT LIKE '09%'                                                            ");
		sql.append("                   AND IFNULL(Z.DC_YN, 'N')     = 'N'                                                          ");
		sql.append("                   AND IFNULL(Z.BANNAB_YN, 'N') = 'N'                                                          ");
		sql.append("                 GROUP BY Z.ACTING_DATE                                                                        ");
		sql.append("                ) W                                                                                            ");
		sql.append("          GROUP BY W.ACTING_DATE ) D ON E.HOLI_DAY   = D.NAEWON_DATE                                           ");
		sql.append("                  LEFT OUTER JOIN (SELECT NAEWON_DATE, COUNT(CNT)  SU                                          ");
		sql.append("          FROM (SELECT DATE_FORMAT(Z.JUBSU_DATE, '%Y/%m/%d') NAEWON_DATE, COUNT(*) CNT                                                  ");
		sql.append("                  FROM DRG2010 X                                                                               ");
		sql.append("                     , OCS1003 Y                                                                               ");
		sql.append("                     , DRG2030 Z                                                                               ");
		sql.append("                 WHERE X.HOSP_CODE = :f_hosp_code                                                              ");
		sql.append("                   AND X.NAEWON_DATE BETWEEN STR_TO_DATE(CONCAT(:f_date,'01'),'%Y%m%d')                        ");
		sql.append("                                         AND LAST_DAY(STR_TO_DATE(:f_date,'%Y%m'))                             ");
		sql.append("                   AND X.BUNRYU1   <> '4'                                                                      ");
		sql.append("                   AND X.ACT_DATE  IS NOT NULL                                                                 ");
		sql.append("                   AND X.BUNHO     NOT LIKE '09%'                                                              ");
		sql.append("                   AND IFNULL(X.DC_YN, 'N')     = 'N'                                                          ");
		sql.append("                   AND IFNULL(X.BANNAB_YN, 'N') = 'N'                                                          ");
		sql.append("                   AND Y.HOSP_CODE = X.HOSP_CODE                                                               ");
		sql.append("                   AND Y.PKOCS1003 = X.FKOCS1003                                                               ");
		sql.append("                   AND Z.HOSP_CODE = Y.HOSP_CODE                                                               ");
		sql.append("                   AND Z.FKOCS1003 = Y.PKOCS1003                                                               ");
		sql.append("                 GROUP BY Z.JUBSU_DATE, Z.DRG_BUNHO, Z.SERIAL_V                                                ");
		sql.append("                 ) W                                                                                           ");
		sql.append("         GROUP BY W.NAEWON_DATE) G ON  E.HOLI_DAY   = G.NAEWON_DATE                                            ");
		sql.append("                LEFT OUTER JOIN (SELECT ACTING_DATE NAEWON_DATE, COUNT(CNT)  SU                                ");
		sql.append("          FROM (                                                                                               ");
		sql.append("                SELECT DATE_FORMAT(Z.ACTING_DATE, '%Y/%m/%d') ACTING_DATE, Z.BUNHO, COUNT(Z.HANGMOG_CODE) CNT                                       ");
		sql.append("                  FROM OCS1003 Z                                                                               ");
		sql.append("                 WHERE Z.HOSP_CODE   = :f_hosp_code                                                            ");
		sql.append("                   AND Z.SLIP_CODE   LIKE 'J%'                                                                 ");
		sql.append("                   AND Z.ACTING_DATE BETWEEN STR_TO_DATE(CONCAT(:f_date,'01'),'%Y%m%d')                        ");
		sql.append("                                         AND LAST_DAY(STR_TO_DATE(:f_date,'%Y%m'))                             ");
		sql.append("                   AND Z.ACTING_DATE IS NOT NULL                                                               ");
		sql.append("                   AND Z.BUNHO       NOT LIKE '09%'                                                            ");
		sql.append("                   AND IFNULL(Z.DC_YN, 'N')     = 'N'                                                          ");
		sql.append("                   AND IFNULL(Z.BANNAB_YN, 'N') = 'N'                                                          ");
		sql.append("                 GROUP BY Z.ACTING_DATE, Z.BUNHO, Z.GROUP_SER                                                  ");
		sql.append("                ) W                                                                                            ");
		sql.append("          GROUP BY W.ACTING_DATE ) H ON  DATE_FORMAT(E.HOLI_DAY, '%Y/%m/%d')   = H.NAEWON_DATE          ");
		sql.append("   WHERE E.HOLI_DAY   BETWEEN STR_TO_DATE(CONCAT(:f_date,'01'),'%Y%m%d')                                         ");
		sql.append("                AND LAST_DAY(STR_TO_DATE(:f_date,'%Y%m'))                                                      ");
		sql.append(" ORDER BY 1                                                                                                    ");
		
		Query query = entityManager.createNativeQuery(sql.toString());
		query.setParameter("f_hosp_code", hospCode);
		query.setParameter("f_date", date);
		
		List<DRG9001GetLay9001Info> result = new JpaResultMapper().list(query, DRG9001GetLay9001Info.class);
		return result;
		
	}
	
	@Override
	public List<DRG9001GetLay9001Info> getDRG9001R02GetLay9001Info(String hospCode, String date) {
		StringBuilder sql = new StringBuilder();
		sql.append("SELECT DISTINCT DATE_FORMAT(E.HOLI_DAY, '%Y/%m')          AS HOLI_DAY                                                                    ");
		sql.append("     , IFNULL(A.SU, 0)                                    AS DRG_CNT                                                                     ");
		sql.append("     , IFNULL(G.SU, 0)                                    AS DRG_GROUP_CNT                                                               ");
		sql.append("     , IFNULL(C.SU, 0)                                    AS DRG_HANGMOG_CNT                                                             ");
		sql.append("     , IFNULL(B.SU, 0)                                    AS INJ_CNT                                                                     ");
		sql.append("     , IFNULL(H.SU, 0)                                    AS INJ_GROUP_CNT                                                               ");
		sql.append("     , IFNULL(D.SU, 0)                                    AS INJ_HANGMOG_CNT                                                             ");
		sql.append("     , IFNULL(A.SU, 0) + IFNULL(B.SU, 0)                     AS DRG_INJ_CNT                                                              ");
		sql.append("     , IFNULL(G.SU, 0) + IFNULL(H.SU, 0)                     AS DRG_INJ_GROUP_CNT                                                        ");
		sql.append("     , IFNULL(C.SU, 0) + IFNULL(D.SU, 0)                     AS DRG_INJ_HANGMOG_CNT                                                      ");
		sql.append("  FROM RES0101 E LEFT OUTER JOIN (SELECT NAEWON_DATE , COUNT(*)  SU                                                                      ");
		sql.append("          FROM (                                                                                                                         ");
		sql.append("                SELECT DATE_FORMAT(X.NAEWON_DATE, '%Y/%m') NAEWON_DATE, X.DRG_BUNHO, SUM(1)                                              ");
		sql.append("                  FROM DRG2010 X                                                                                                         ");
		sql.append("                 WHERE X.HOSP_CODE = :f_hosp_code                                                                                        ");
		sql.append("                   AND X.NAEWON_DATE BETWEEN STR_TO_DATE(CONCAT(:f_date,'0101'),'%Y%m%d')                                                ");
		sql.append("                                         AND STR_TO_DATE(CONCAT(:f_date,'1231'),'%Y%m%d')                                                ");
		sql.append("                   AND X.BUNRYU1   <> '4'                                                                                                ");
		sql.append("                   AND X.ACT_DATE  IS NOT NULL                                                                                           ");
		sql.append("                   AND IFNULL(X.DC_YN, 'N')     = 'N'                                                                                    ");
		sql.append("                   AND IFNULL(X.BANNAB_YN, 'N') = 'N'                                                                                    ");
		sql.append("                   AND X.BUNHO               NOT LIKE '09%'                                                                              ");
		sql.append("                 GROUP BY X.NAEWON_DATE, X.DRG_BUNHO                                                                                     ");
		sql.append("                ) W                                                                                                                      ");
		sql.append("         GROUP BY W.NAEWON_DATE ) A ON DATE_FORMAT(E.HOLI_DAY, '%Y/%m')   = A.NAEWON_DATE                                                ");
		sql.append("                  LEFT OUTER JOIN  (SELECT ACTING_DATE NAEWON_DATE, COUNT(*)  SU                                                         ");
		sql.append("          FROM (SELECT DATE_FORMAT(Z.ACTING_DATE, '%Y/%m') ACTING_DATE, Z.BUNHO, SUM(1)                                                  ");
		sql.append("                  FROM OCS1003 Z                                                                                                         ");
		sql.append("                 WHERE Z.HOSP_CODE   = :f_hosp_code                                                                                      ");
		sql.append("                   AND Z.SLIP_CODE   LIKE 'J%'                                                                                           ");
		sql.append("                   AND Z.ACTING_DATE BETWEEN STR_TO_DATE(CONCAT(:f_date,'0101'),'%Y%m%d')                                                ");
		sql.append("                                         AND STR_TO_DATE(CONCAT(:f_date,'1231'),'%Y%m%d')                                                ");
		sql.append("                   AND Z.ACTING_DATE IS NOT NULL                                                                                         ");
		sql.append("                   AND Z.BUNHO       NOT LIKE '09%'                                                                                      ");
		sql.append("                   AND IFNULL(Z.DC_YN, 'N')     = 'N'                                                                                    ");
		sql.append("                   AND IFNULL(Z.BANNAB_YN, 'N') = 'N'                                                                                    ");
		sql.append("                 GROUP BY Z.ACTING_DATE, Z.BUNHO) W                                                                                      ");
		sql.append("        GROUP BY W.ACTING_DATE) B ON DATE_FORMAT(E.HOLI_DAY, '%Y/%m')   = B.NAEWON_DATE                                                  ");
		sql.append("                 LEFT OUTER JOIN (SELECT NAEWON_DATE , SUM(CNT)  SU                                                                      ");
		sql.append("          FROM (                                                                                                                         ");
		sql.append("                SELECT DATE_FORMAT(X.NAEWON_DATE, '%Y/%m') NAEWON_DATE, X.DRG_BUNHO, COUNT(X.JAERYO_CODE) CNT                            ");
		sql.append("                  FROM DRG2010 X                                                                                                         ");
		sql.append("                 WHERE X.HOSP_CODE = :f_hosp_code                                                                                        ");
		sql.append("                   AND X.NAEWON_DATE BETWEEN STR_TO_DATE(CONCAT(:f_date,'0101'),'%Y%m%d')                                                ");
		sql.append("                                         AND STR_TO_DATE(CONCAT(:f_date,'1231'),'%Y%m%d')                                                ");
		sql.append("                   AND X.BUNRYU1   <> '4'                                                                                                ");
		sql.append("                   AND X.ACT_DATE  IS NOT NULL                                                                                           ");
		sql.append("                   AND X.BUNHO     NOT LIKE '09%'                                                                                        ");
		sql.append("                   AND IFNULL(X.DC_YN, 'N')     = 'N'                                                                                    ");
		sql.append("                   AND IFNULL(X.BANNAB_YN, 'N') = 'N'                                                                                    ");
		sql.append("                 GROUP BY X.NAEWON_DATE, X.DRG_BUNHO                                                                                     ");
		sql.append("               ) W                                                                                                                       ");
		sql.append("         GROUP BY W.NAEWON_DATE ) C ON DATE_FORMAT(E.HOLI_DAY, '%Y/%m')   = C.NAEWON_DATE                                                ");
		sql.append("                  LEFT OUTER JOIN (SELECT ACTING_DATE NAEWON_DATE, SUM(CNT)  SU                                                          ");
		sql.append("          FROM (SELECT DATE_FORMAT(Z.ACTING_DATE, '%Y/%m') ACTING_DATE, Z.BUNHO, COUNT(Z.HANGMOG_CODE) CNT                               ");
		sql.append("                  FROM OCS1003 Z                                                                                                         ");
		sql.append("                 WHERE Z.HOSP_CODE   = :f_hosp_code                                                                                      ");
		sql.append("                   AND Z.SLIP_CODE   LIKE 'J%'                                                                                           ");
		sql.append("                   AND Z.ACTING_DATE BETWEEN STR_TO_DATE(CONCAT(:f_date,'0101'),'%Y%m%d')                                                ");
		sql.append("                                         AND STR_TO_DATE(CONCAT(:f_date,'1231'),'%Y%m%d')                                                ");
		sql.append("                   AND Z.ACTING_DATE IS NOT NULL                                                                                         ");
		sql.append("                   AND Z.BUNHO       NOT LIKE '09%'                                                                                      ");
		sql.append("                   AND IFNULL(Z.DC_YN, 'N')     = 'N'                                                                                    ");
		sql.append("                   AND IFNULL(Z.BANNAB_YN, 'N') = 'N'                                                                                    ");
		sql.append("                 GROUP BY Z.ACTING_DATE, Z.BUNHO                                                                                         ");
		sql.append("                ) W                                                                                                                      ");
		sql.append("          GROUP BY W.ACTING_DATE ) D ON DATE_FORMAT(E.HOLI_DAY, '%Y/%m')   = D.NAEWON_DATE                                               ");
		sql.append("                    LEFT OUTER JOIN (SELECT NAEWON_DATE , COUNT(CNT)  SU                                                                 ");
		sql.append("          FROM (                                                                                                                         ");
		sql.append("                SELECT DATE_FORMAT(Z.JUBSU_DATE, '%Y/%m') NAEWON_DATE, COUNT(1) CNT                                                      ");
		sql.append("                  FROM DRG2010 X                                                                                                         ");
		sql.append("                     , OCS1003 Y                                                                                                         ");
		sql.append("                     , DRG2030 Z                                                                                                         ");
		sql.append("                 WHERE X.HOSP_CODE = :f_hosp_code                                                                                        ");
		sql.append("                   AND X.NAEWON_DATE BETWEEN STR_TO_DATE(CONCAT(:f_date,'0101'),'%Y%m%d')                                                ");
		sql.append("                                         AND STR_TO_DATE(CONCAT(:f_date,'1231'),'%Y%m%d')                                                ");
		sql.append("                   AND X.BUNRYU1   <> '4'                                                                                                ");
		sql.append("                   AND X.ACT_DATE  IS NOT NULL                                                                                           ");
		sql.append("                   AND X.BUNHO     NOT LIKE '09%'                                                                                        ");
		sql.append("                   AND IFNULL(X.DC_YN, 'N')     = 'N'                                                                                    ");
		sql.append("                   AND IFNULL(X.BANNAB_YN, 'N') = 'N'                                                                                    ");
		sql.append("                   AND Y.HOSP_CODE = X.HOSP_CODE                                                                                         ");
		sql.append("                   AND Y.PKOCS1003 = X.FKOCS1003                                                                                         ");
		sql.append("                   AND Z.HOSP_CODE = Y.HOSP_CODE                                                                                         ");
		sql.append("                   AND Z.FKOCS1003 = Y.PKOCS1003                                                                                         ");
		sql.append("                 GROUP BY Z.JUBSU_DATE, Z.DRG_BUNHO, Z.SERIAL_V                                                                          ");
		sql.append("               ) W                                                                                                                       ");
		sql.append("         GROUP BY W.NAEWON_DATE ) G ON DATE_FORMAT(E.HOLI_DAY, '%Y/%m')   = G.NAEWON_DATE                                                ");
		sql.append("                      LEFT OUTER JOIN (SELECT ACTING_DATE NAEWON_DATE, COUNT(CNT)  SU                                                    ");
		sql.append("          FROM (                                                                                                                         ");
		sql.append("                SELECT DATE_FORMAT(Z.ACTING_DATE, '%Y/%m') ACTING_DATE, Z.BUNHO, SUM(1) CNT                                              ");
		sql.append("                  FROM OCS1003 Z                                                                                                         ");
		sql.append("                 WHERE Z.HOSP_CODE   = :f_hosp_code                                                                                      ");
		sql.append("                   AND Z.SLIP_CODE   LIKE 'J%'                                                                                           ");
		sql.append("                   AND Z.ACTING_DATE BETWEEN STR_TO_DATE(CONCAT(:f_date,'0101'),'%Y%m%d')                                                ");
		sql.append("                                         AND STR_TO_DATE(CONCAT(:f_date,'1231'),'%Y%m%d')                                                ");
		sql.append("                   AND Z.ACTING_DATE IS NOT NULL                                                                                         ");
		sql.append("                   AND Z.BUNHO       NOT LIKE '09%'                                                                                      ");
		sql.append("                   AND IFNULL(Z.DC_YN, 'N')     = 'N'                                                                                    ");
		sql.append("                   AND IFNULL(Z.BANNAB_YN, 'N') = 'N'                                                                                    ");
		sql.append("                 GROUP BY Z.ACTING_DATE, Z.BUNHO, Z.GROUP_SER                                                                            ");
		sql.append("                ) W                                                                                                                      ");
		sql.append("          GROUP BY W.ACTING_DATE ) H ON DATE_FORMAT(E.HOLI_DAY, '%Y/%m')   = H.NAEWON_DATE                                               ");
		sql.append(" WHERE E.HOLI_DAY   BETWEEN STR_TO_DATE(CONCAT(:f_date,'01'),'%Y%m') AND LAST_DAY(STR_TO_DATE(CONCAT(:f_date,'12'),'%Y%m'))              ");
		sql.append(" ORDER BY 1                                                                                                                              ");
		
		Query query = entityManager.createNativeQuery(sql.toString());
		query.setParameter("f_hosp_code", hospCode);
		query.setParameter("f_date", date);
		
		
		List<DRG9001GetLay9001Info> result = new JpaResultMapper().list(query, DRG9001GetLay9001Info.class);
		return result;
	}

	@Override
	public List<DRG9001R03lay9001RInfo> getDRG9001R03lay9001RInfo(String hospCode, String date, String hoDong) {
		StringBuilder sql = new StringBuilder();
		sql.append("	SELECT                                                                                                                                                   				");
		sql.append("    	DATE_FORMAT(E.HOLI_DAY, '%Y/%m/%d')                           AS HOLI_DAY,                                                                               			");
		sql.append("    	CAST(IFNULL(A.SU, 0) AS CHAR)                                 AS DRG_CNT,                                                                                           ");
		sql.append("    	CAST(IFNULL(G.SU, 0) AS CHAR)                                 AS DRG_GROUP_CNT,                                                                                     ");
		sql.append("    	CAST(IFNULL(C.SU, 0) AS CHAR)                                 AS DRG_HANGMOG_CNT,                                                                                   ");
		sql.append("    	CAST(IFNULL(B.SU, 0) AS CHAR)                                 AS INJ_CNT,                                                                                           ");
		sql.append("    	CAST(IFNULL(H.SU, 0) AS CHAR)                                 AS INJ_GROUP_CNT,                                                                                     ");
		sql.append("    	CAST(IFNULL(D.SU, 0) AS CHAR)                                 AS INJ_HANGMOG_CNT,                                                                                   ");
		sql.append("    	CAST(IFNULL(A.SU, 0) + IFNULL(B.SU, 0) AS CHAR)               AS DRG_INJ_CNT,                                                                                       ");
		sql.append("    	CAST(IFNULL(G.SU, 0) + IFNULL(H.SU, 0) AS CHAR)               AS DRG_INJ_GROUP_CNT,                                                                                 ");
		sql.append("    	CAST(IFNULL(C.SU, 0) + IFNULL(D.SU, 0) AS CHAR)               AS DRG_INJ_HANGMOG_CNT                                                                                ");
		sql.append("	FROM                                                                                                                                                     	            ");
		sql.append("	RES0101 E LEFT JOIN                                                                                                                                      	            ");
		sql.append("				(                                                                                                                                      	                    ");
		sql.append("					SELECT                                                                                                                       	                        ");
		sql.append("						JUBSU_DATE,                                                                                                              	                        ");
		sql.append("						COUNT(*)  SU                                                                                                             	                        ");
		sql.append("			        FROM                                                                                                                                   					");
		sql.append("						(                                                                                                                        							");
		sql.append("			            	SELECT                                                                                                                             				");
		sql.append("								X.JUBSU_DATE JUBSU_DATE,                                                                                         	                        ");
		sql.append("								X.DRG_BUNHO,                                                                                                     	                        ");
		sql.append("								SUM(1)                                                                                                           	                        ");
		sql.append("			              	FROM                                                                                                                               				");
		sql.append("								DRG3010 X                                                                                                        							");
		sql.append("			              	WHERE                                                                                                                             				");
		sql.append("								X.HOSP_CODE  = :f_hosp_code                                                                                      							");
		sql.append("			                	AND X.JUBSU_DATE BETWEEN STR_TO_DATE(CONCAT(:f_date, '01'),'%Y%m%d') AND LAST_DAY(STR_TO_DATE(:f_date,'%Y%m'))                   	        ");
		sql.append("			                	AND X.BUNRYU1    <> '4'                                                                                                          	        ");
		sql.append("			                	AND X.JUBSU_DATE IS NOT NULL                                                                                                     	        ");
		sql.append("			                	AND X.DRG_BUNHO  IS NOT NULL                                                                                                     	        ");
		sql.append("			                	AND X.HO_DONG    LIKE CONCAT(:f_ho_dong, '%')                                                                                    	        ");
		sql.append("			                	AND IFNULL(X.DC_YN, 'N')     = 'N'                                                                                               	        ");
		sql.append("			                	AND IFNULL(X.BANNAB_YN, 'N') = 'N'                                                                                               	        ");
		sql.append("			                	AND X.BUNHO               NOT LIKE '09%'                                                                                         	        ");
		sql.append("			              	GROUP BY X.JUBSU_DATE, X.DRG_BUNHO                                                                                                 	            ");
		sql.append("			            ) TMP                                                                                                                                	            ");
		sql.append("			        GROUP BY TMP.JUBSU_DATE                                                                                                              		            ");
		sql.append("				) A                                                                                                                              							");
		sql.append("	  			ON E.HOLI_DAY = A.JUBSU_DATE                                                                                                             	                ");
		sql.append("	  			LEFT JOIN                                                                                                                                	                ");
		sql.append("					(                                                                                                                                      	                ");
		sql.append("						SELECT                                                                                                                       	                    ");
		sql.append("							JUBSU_DATE,                                                                                                              	                    ");
		sql.append("							COUNT(CNT) SU                                                                                                            	                    ");
		sql.append("				        FROM                                                                                                                                 				");
		sql.append("							(                                                                                                                        						");
		sql.append("				          		SELECT X.JUBSU_DATE JUBSU_DATE, X.DRG_BUNHO, SUM(1) CNT                                                                          			");
		sql.append("				            	FROM                                                                                                                   						");
		sql.append("				            		DRG3011 X 	JOIN 	DRG3010 Y                                                                                                           ");
		sql.append("				                    			ON	    X.HOSP_CODE = Y.HOSP_CODE                                                                                           ");
		sql.append("				                    			AND	    X.PKDRG3011 = Y.FKDRG3011                                                                                           ");
		sql.append("				            	WHERE X.HOSP_CODE  = :f_hosp_code                                                                                                			");
		sql.append("				                   AND X.JUBSU_DATE BETWEEN STR_TO_DATE(CONCAT(:f_date, '01'),'%Y%m%d')                                                      	            ");
		sql.append("				                                        AND LAST_DAY(STR_TO_DATE(:f_date,'%Y%m'))                                                            	            ");
		sql.append("				                   AND X.BUNRYU1    <> '4'                                                                                                   	            ");
		sql.append("				                   AND X.DRG_BUNHO  IS NOT NULL                                                                                              	            ");
		sql.append("				                   AND X.HO_DONG    LIKE CONCAT(:f_ho_dong, '%')                                                                             	            ");
		sql.append("				                   AND X.BUNHO      NOT LIKE '09%'                                                                                           	            ");
		sql.append("				                   AND IFNULL(Y.BANNAB_YN, 'N') = 'N'                                                                                        	            ");
		sql.append("				                   AND IFNULL(Y.DC_YN, 'N')     = 'N'                                                                                        	            ");
		sql.append("				            	GROUP BY X.JUBSU_DATE, X.DRG_BUNHO, X.GROUP_SER                                                                                  			");
		sql.append("				          ) TMP                                                                                                                              	            ");
		sql.append("				      	GROUP BY                                                                                                                             	            ");
		sql.append("							TMP.JUBSU_DATE                                                                                                           	                    ");
		sql.append("					) G                                                                                                                              	                    ");
		sql.append("					ON E.HOLI_DAY = G.JUBSU_DATE                                                                                                 							");
		sql.append("	   				LEFT JOIN                                                                                                                                	            ");
		sql.append("	 					(                                                                                                                                    	            ");
		sql.append("							SELECT                                                                                                                       	                ");
		sql.append("								JUBSU_DATE,                                                                                                              	                ");
		sql.append("								SUM(CNT)  SU                                                                                                             	                ");
		sql.append("			          		FROM                                                                                                                                   			");
		sql.append("								(                                                                                                                        					");
		sql.append("			              			SELECT X.JUBSU_DATE JUBSU_DATE, X.DRG_BUNHO, COUNT(X.JAERYO_CODE) CNT                                                              	    ");
		sql.append("			              			FROM                                                                                                                               	    ");
		sql.append("										DRG3011 X 	JOIN	DRG3010 Y                                                                                        				");
		sql.append("													ON		X.HOSP_CODE = Y.HOSP_CODE                                                            							");
		sql.append("			              			WHERE X.HOSP_CODE  = :f_hosp_code                                                                                                  	    ");
		sql.append("			                   			AND X.JUBSU_DATE BETWEEN STR_TO_DATE(CONCAT(:f_date, '01'),'%Y%m%d') AND LAST_DAY(STR_TO_DATE(:f_date,'%Y%m'))                	    ");
		sql.append("			                   			AND X.BUNRYU1   <> '4'                                                                                                        	    ");
		sql.append("			                   			AND X.DRG_BUNHO IS NOT NULL                                                                                                   	    ");
		sql.append("			                   			AND X.HO_DONG   LIKE CONCAT(:f_ho_dong, '%')                                                                                  	    ");
		sql.append("			                   			AND X.BUNHO     NOT LIKE '09%'                                                                                                	    ");
		sql.append("			                   			AND Y.FKDRG3011 = X.PKDRG3011                                                                                                 	    ");
		sql.append("			                   			AND IFNULL(Y.BANNAB_YN, 'N') = 'N'                                                                                            	    ");
		sql.append("			                   			AND IFNULL(Y.DC_YN, 'N')     = 'N'                                                                                            	    ");
		sql.append("			              			GROUP BY X.JUBSU_DATE, X.DRG_BUNHO                                                                                                 	    ");
		sql.append("			            		) TMP                                                                                                                                	    ");
		sql.append("			         		GROUP BY                                                                                                                             		    ");
		sql.append("							 	TMP.JUBSU_DATE                                                                                                           				    ");
		sql.append("						) C                                                                                                                              				    ");
		sql.append("						ON E.HOLI_DAY = C.JUBSU_DATE                                                                                                 					    ");
		sql.append("	   					LEFT JOIN                                                                                                                                	        ");
		sql.append("	   						(                                                                                                                                    	        ");
		sql.append("								SELECT JUBSU_DATE , COUNT(*)  SU                                                                                         				    ");
		sql.append("	      						FROM                                                                                                                                 	    ");
		sql.append("									(                                                                                                                    					");
		sql.append("			                			SELECT                                                                                                                           	");
		sql.append("											Y.JUBSU_DATE JUBSU_DATE,                                                                                     	                ");
		sql.append("											Y.DRG_BUNHO,                                                                                                 	                ");
		sql.append("											SUM(1)                                                                                                       	                ");
		sql.append("			                			FROM                                                                                                                             	");
		sql.append("											DRG3010 Y                                                                                                    					");
		sql.append("			              				WHERE                                                                                                                            	");
		sql.append("											Y.HOSP_CODE = :f_hosp_code                                                                                   					");
		sql.append("			                  				AND Y.JUBSU_DATE BETWEEN STR_TO_DATE(CONCAT(:f_date, '01'),'%Y%m%d') AND LAST_DAY(STR_TO_DATE(:f_date,'%Y%m'))                 	");
		sql.append("			                  				AND Y.BUNRYU1   = '4'                                                                                                          	");
		sql.append("			                  				AND Y.DRG_BUNHO IS NOT NULL                                                                                                    	");
		sql.append("			                  				AND Y.HO_DONG   LIKE CONCAT(:f_ho_dong, '%')                                                                                   	");
		sql.append("			                  				AND Y.BUNHO     NOT LIKE '09%'                                                                                                 	");
		sql.append("			                  				AND IFNULL(Y.DC_YN, 'N')     = 'N'                                                                                             	");
		sql.append("			                  				AND IFNULL(Y.BANNAB_YN, 'N') = 'N'                                                                                             	");
		sql.append("			              				GROUP BY                                                                                                                         	");
		sql.append("											Y.JUBSU_DATE,                                                                                                	                ");
		sql.append("											Y.DRG_BUNHO                                                                                                  	                ");
		sql.append("	            					) TMP                                                                                                                                	");
		sql.append("	     						GROUP BY                                                                                                                         			");
		sql.append("									TMP.JUBSU_DATE                                                                                                       	                ");
		sql.append("							) B                                                                                                                          	                ");
		sql.append("							ON E.HOLI_DAY = B.JUBSU_DATE                                                                                             						");
		sql.append("				        	LEFT JOIN                                                                                                                            	        ");
		sql.append("				       			(                                                                                                                                	        ");
		sql.append("									SELECT JUBSU_DATE, COUNT(CNT) SU                                                                                     					");
		sql.append("				          			FROM                                                                                                                             		");
		sql.append("										(                                                                                                                					");
		sql.append("				                			SELECT Y.JUBSU_DATE JUBSU_DATE, Y.DRG_BUNHO, SUM(1) CNT                                                                      	");
		sql.append("				                			FROM                                                                                                                         	");
		sql.append("												DRG3011 Y 	JOIN DRG3010 X                                                                                 					");
		sql.append("															ON	 X.HOSP_CODE = Y.HOSP_CODE                                                       							");
		sql.append("				                   							AND X.FKDRG3011 = Y.PKDRG3011                                                                            		");
		sql.append("				                			WHERE Y.HOSP_CODE  = :f_hosp_code                                                                                            	");
		sql.append("				                   				AND Y.JUBSU_DATE BETWEEN STR_TO_DATE(CONCAT(:f_date, '01'),'%Y%m%d') AND LAST_DAY(STR_TO_DATE(:f_date,'%Y%m'))            	");
		sql.append("				                   				AND Y.BUNRYU1   = '4'                                                                                                     	");
		sql.append("				                   				AND Y.DRG_BUNHO IS NOT NULL                                                                                               	");
		sql.append("				                   				AND Y.HO_DONG   LIKE CONCAT(:f_ho_dong, '%')                                                                              	");
		sql.append("				                   				AND Y.BUNHO     NOT LIKE '09%'                                                                                            	");
		sql.append("				                   				AND IFNULL(X.BANNAB_YN, 'N') = 'N'                                                                                        	");
		sql.append("				                   				AND IFNULL(X.DC_YN, 'N')     = 'N'                                                                                        	");
		sql.append("				                			GROUP BY Y.JUBSU_DATE, Y.DRG_BUNHO, Y.GROUP_SER                                                                              	");
		sql.append("				              			) TMP                                                                                                                          		");
		sql.append("				         			GROUP BY                                                                                                                     			");
		sql.append("										TMP.JUBSU_DATE                                                                                                   					");
		sql.append("								) H                                                                                                                      					");
		sql.append("				   				ON E.HOLI_DAY = H.JUBSU_DATE                                                                                                 				");
		sql.append("					        	LEFT JOIN                                                                                                                        			");
		sql.append("					       			(                                                                                                                            			");
		sql.append("										SELECT                                                                                                           					");
		sql.append("											JUBSU_DATE,                                                                                                  					");
		sql.append("											SUM(CNT) SU                                                                                                  					");
		sql.append("						          		FROM (                                                                                                                     			");
		sql.append("						                		SELECT Y.JUBSU_DATE JUBSU_DATE, Y.DRG_BUNHO, COUNT(Y.JAERYO_CODE) CNT                                                		");
		sql.append("						                		FROM                                                                                                                 		");
		sql.append("													DRG3011 Y 	JOIN DRG3010 X                                                                         						");
		sql.append("																ON	X.HOSP_CODE = Y.HOSP_CODE                                                								");
		sql.append("						                  						AND X.FKDRG3011 = Y.PKDRG3011                                                                    			");
		sql.append("						                		WHERE Y.HOSP_CODE = :f_hosp_code                                                                                     		");
		sql.append("						                  			AND Y.JUBSU_DATE BETWEEN STR_TO_DATE(CONCAT(:f_date, '01'),'%Y%m%d') AND LAST_DAY(STR_TO_DATE(:f_date,'%Y%m'))     	    ");
		sql.append("						                  			AND Y.BUNRYU1   = '4'                                                                                              	    ");
		sql.append("						                  			AND Y.DRG_BUNHO IS NOT NULL                                                                                        	    ");
		sql.append("						                  			AND Y.HO_DONG   LIKE CONCAT(:f_ho_dong, '%')                                                                       	    ");
		sql.append("						                  			AND Y.BUNHO     NOT LIKE '09%'                                                                                     	    ");
		sql.append("						                  			AND IFNULL(X.BANNAB_YN, 'N') = 'N'                                                                                 	    ");
		sql.append("						                  			AND IFNULL(X.DC_YN, 'N')     = 'N'                                                                                 	    ");
		sql.append("						                	GROUP BY                                                                                                             		    ");
		sql.append("												Y.JUBSU_DATE, Y.DRG_BUNHO                                                                        						    ");
		sql.append("						         	  	) TMP                                                                                                              				    ");
		sql.append("						         		GROUP BY                                                                                                                 		    ");
		sql.append("											TMP.JUBSU_DATE                                                                                               				    ");
		sql.append("									) D                                                                                                                  				    ");
		sql.append("					   				ON E.HOLI_DAY = D.JUBSU_DATE                                                                                             			    ");
		sql.append("	WHERE                                                                                                                                                    			    ");
		sql.append("		E.HOLI_DAY BETWEEN STR_TO_DATE(CONCAT(:f_date, '01'),'%Y%m%d') AND LAST_DAY(STR_TO_DATE(:f_date,'%Y%m'))                                             		    ");
		sql.append("	ORDER BY                                                                                                                                                 			    ");
		sql.append("		E.HOLI_DAY                                                                                                                                               		    ");
		
		Query query = entityManager.createNativeQuery(sql.toString());
		query.setParameter("f_hosp_code", hospCode);
		query.setParameter("f_date", date);
		query.setParameter("f_ho_dong", hoDong);
		
		List<DRG9001R03lay9001RInfo> listInfo = new JpaResultMapper().list(query, DRG9001R03lay9001RInfo.class);
		return listInfo;
	}

	@Override
	public List<DRG9001R04lay9001RInfo> getDRG9001R04lay9001RInfo(String hospCode, String date, String hoDong) {
		StringBuilder sql = new StringBuilder();
		sql.append("	SELECT                                                                                                                             								");
		sql.append("		DISTINCT DATE_FORMAT(E.HOLI_DAY, '%Y/%m')          						AS HOLI_DAY,                                        ");
		sql.append("	    CAST(IFNULL(A.SU, 0) AS CHAR)                                         	AS DRG_CNT,                                         ");
		sql.append("	    CAST(IFNULL(G.SU, 0) AS CHAR)                                         	AS DRG_GROUP_CNT,                                   ");
		sql.append("	    CAST(IFNULL(C.SU, 0) AS CHAR)                                         	AS DRG_HANGMOG_CNT,                                 ");
		sql.append("	    CAST(IFNULL(B.SU, 0) AS CHAR)                                         	AS INJ_CNT,                                         ");
		sql.append("	    CAST(IFNULL(H.SU, 0) AS CHAR)                                         	AS INJ_GROUP_CNT,                                   ");
		sql.append("	    CAST(IFNULL(D.SU, 0) AS CHAR)                                         	AS INJ_HANGMOG_CNT,                                 ");
		sql.append("	    CAST(IFNULL(A.SU, 0) + IFNULL(B.SU, 0) AS CHAR)                       	AS DRG_INJ_CNT,                                     ");
		sql.append("	    CAST(IFNULL(G.SU, 0) + IFNULL(H.SU, 0) AS CHAR)                       	AS DRG_INJ_GROUP_CNT,                               ");
		sql.append("	    CAST(IFNULL(C.SU, 0) + IFNULL(D.SU, 0) AS CHAR)                       	AS DRG_INJ_HANGMOG_CNT                              ");
		sql.append("	FROM                                                                                                                            ");
		sql.append("		RES0101 E LEFT JOIN                                                                                                         ");
		sql.append("	    	(                                                                                                                       ");
		sql.append("	    		SELECT                                                                                                              ");
		sql.append("	        		JUBSU_DATE,                                                                                                     ");
		sql.append("	        		COUNT(*)  SU                                                                                                    ");
		sql.append("	        	FROM                                                                                                                ");
		sql.append("	        		(                                                                                                               ");
		sql.append("	              		SELECT DATE_FORMAT(X.JUBSU_DATE, '%Y/%m') JUBSU_DATE, X.DRG_BUNHO, SUM(1)                                   ");
		sql.append("	                	FROM DRG3010 X                                                                                              ");
		sql.append("	               		WHERE X.HOSP_CODE = :f_hosp_code                                                                            ");
		sql.append("	                 		AND X.JUBSU_DATE BETWEEN STR_TO_DATE(CONCAT(:f_date, '0101'),'%Y%m%d')                                  ");
		sql.append("	                                      AND STR_TO_DATE(CONCAT(:f_date, '1231'),'%Y%m%d')                                         ");
		sql.append("	                        AND X.BUNRYU1   <> '4'                                                                                  ");
		sql.append("	                        AND X.DRG_BUNHO IS NOT NULL                                                                             ");
		sql.append("	                        AND X.HO_DONG   LIKE CONCAT(:f_ho_dong, '%')                                                            ");
		sql.append("	                        AND X.BUNHO     NOT LIKE '09%'                                                                          ");
		sql.append("	                        AND IFNULL(X.DC_YN, 'N')     = 'N'                                                                      ");
		sql.append("	                        AND IFNULL(X.BANNAB_YN, 'N') = 'N'                                                                      ");
		sql.append("	               		GROUP BY X.JUBSU_DATE, X.DRG_BUNHO                                                                          ");
		sql.append("	              	) TMP                                                                                                           ");
		sql.append("	       		GROUP BY TMP.JUBSU_DATE                                                                                             ");
		sql.append("	       	) A                                                                                                                     ");
		sql.append("	 		ON DATE_FORMAT(E.HOLI_DAY, '%Y/%m') = A.JUBSU_DATE                                                                      ");
		sql.append("	  	LEFT JOIN                                                                                                                   ");
		sql.append("	     	(                                                                                                                       ");
		sql.append("	     		SELECT                                                                                                              ");
		sql.append("	     			JUBSU_DATE,                                                                                                     ");
		sql.append("	     			COUNT(CNT) SU                                                                                                   ");
		sql.append("	        	FROM                                                                                                                ");
		sql.append("	        		(                                                                                                               ");
		sql.append("	            		SELECT DATE_FORMAT(X.JUBSU_DATE, '%Y/%m') JUBSU_DATE, X.DRG_BUNHO, SUM(1) CNT                               ");
		sql.append("	                	FROM DRG3011 X JOIN DRG3010 Y                                                                               ");
		sql.append("	                        ON X.HOSP_CODE = Y.HOSP_CODE                                                                            ");
		sql.append("	                        AND X.PKDRG3011 = Y.FKDRG3011                                                                           ");
		sql.append("	               		WHERE X.HOSP_CODE = :f_hosp_code                                                                            ");
		sql.append("	                 		AND X.JUBSU_DATE BETWEEN STR_TO_DATE(CONCAT(:f_date, '0101'),'%Y%m%d')                                  ");
		sql.append("	                                      AND STR_TO_DATE(CONCAT(:f_date, '1231'),'%Y%m%d')                                         ");
		sql.append("	                        AND X.BUNRYU1   <> '4'                                                                                  ");
		sql.append("	                        AND X.DRG_BUNHO IS NOT NULL                                                                             ");
		sql.append("	                        AND X.HO_DONG   LIKE CONCAT(:f_ho_dong, '%')                                                            ");
		sql.append("	                        AND X.BUNHO     NOT LIKE '09%'                                                                          ");
		sql.append("	                        AND IFNULL(Y.BANNAB_YN, 'N') = 'N'                                                                      ");
		sql.append("	                        AND IFNULL(Y.DC_YN, 'N')     = 'N'                                                                      ");
		sql.append("	               		GROUP BY X.JUBSU_DATE, X.DRG_BUNHO, X.GROUP_SER                                                             ");
		sql.append("	             	) TMP                                                                                                           ");
		sql.append("	       		GROUP BY TMP.JUBSU_DATE                                                                                             ");
		sql.append("	       	) G                                                                                                                     ");
		sql.append("	 		ON DATE_FORMAT(E.HOLI_DAY, '%Y/%m') = G.JUBSU_DATE                                                                      ");
		sql.append("	  	LEFT JOIN                                                                                                                   ");
		sql.append("	     	(                                                                                                                       ");
		sql.append("	     		SELECT                                                                                                              ");
		sql.append("	     			JUBSU_DATE,                                                                                                     ");
		sql.append("	     			SUM(CNT) SU                                                                                                     ");
		sql.append("	        	FROM                                                                                                                ");
		sql.append("	        		(                                                                                                               ");
		sql.append("	            		SELECT DATE_FORMAT(X.JUBSU_DATE, '%Y/%m') JUBSU_DATE, X.DRG_BUNHO, COUNT(X.JAERYO_CODE) CNT                 ");
		sql.append("	               		FROM DRG3011 X JOIN DRG3010 Y                                                                               ");
		sql.append("	               			ON X.HOSP_CODE = Y.HOSP_CODE                                                                            ");
		sql.append("	               			AND X.PKDRG3011 = Y.FKDRG3011                                                                           ");
		sql.append("	            		WHERE X.HOSP_CODE = :f_hosp_code                                                                            ");
		sql.append("	               			AND X.JUBSU_DATE BETWEEN STR_TO_DATE(CONCAT(:f_date, '0101'),'%Y%m%d')                                  ");
		sql.append("	                                  AND STR_TO_DATE(CONCAT(:f_date, '1231'),'%Y%m%d')                                            	");
		sql.append("	                        AND X.BUNRYU1   <> '4'                                                                                  ");
		sql.append("	                        AND X.DRG_BUNHO IS NOT NULL                                                                             ");
		sql.append("	                        AND X.HO_DONG   LIKE CONCAT(:f_ho_dong, '%')                                                            ");
		sql.append("	                        AND X.BUNHO     NOT LIKE '09%'                                                                          ");
		sql.append("	                        AND IFNULL(Y.BANNAB_YN, 'N') = 'N'                                                                      ");
		sql.append("	                        AND IFNULL(Y.DC_YN, 'N')     = 'N'                                                                      ");
		sql.append("	               		GROUP BY X.JUBSU_DATE, X.DRG_BUNHO                                                                          ");
		sql.append("	             	) TMP                                                                                                           ");
		sql.append("	       		GROUP BY                                                                                                            ");
		sql.append("	        		TMP.JUBSU_DATE                                                                                                  ");
		sql.append("	        ) C                                                                                                         			");
		sql.append("	 		ON DATE_FORMAT(E.HOLI_DAY, '%Y/%m') = C.JUBSU_DATE                                                                      ");
		sql.append("	  	LEFT JOIN                                                                                                                   ");
		sql.append("	    	(                                                                                             							");
		sql.append("	     		SELECT JUBSU_DATE , COUNT(*)  SU                                                                                    ");
		sql.append("	        	FROM                                                                                                                ");
		sql.append("	        		(                                                                                                               ");
		sql.append("	              		SELECT DATE_FORMAT(Y.JUBSU_DATE, '%Y/%m') JUBSU_DATE, Y.DRG_BUNHO, SUM(1)                                   ");
		sql.append("	                	FROM DRG3010 Y                                                                                              ");
		sql.append("	               		WHERE Y.HOSP_CODE = :f_hosp_code                                                                            ");
		sql.append("	                 		AND Y.JUBSU_DATE BETWEEN STR_TO_DATE(CONCAT(:f_date, '0101'),'%Y%m%d')                                  ");
		sql.append("	                                  AND STR_TO_DATE(CONCAT(:f_date, '1231'),'%Y%m%d')                                            	");
		sql.append("	                 		AND Y.BUNRYU1   = '4'                                                                                   ");
		sql.append("	                 		AND Y.DRG_BUNHO IS NOT NULL                                                                             ");
		sql.append("	                        AND Y.HO_DONG   LIKE CONCAT(:f_ho_dong, '%')                                                            ");
		sql.append("	                        AND Y.BUNHO     NOT LIKE '09%'                                                                          ");
		sql.append("	                        AND IFNULL(Y.DC_YN, 'N')     = 'N'                                                                      ");
		sql.append("	                        AND IFNULL(Y.BANNAB_YN, 'N') = 'N'                                                                      ");
		sql.append("	               		GROUP BY Y.JUBSU_DATE, Y.DRG_BUNHO                                                                          ");
		sql.append("	               	) TMP                                                                                                           ");
		sql.append("	       		GROUP BY                                                                                                            ");
		sql.append("	        		TMP.JUBSU_DATE                                                                                                  ");
		sql.append("	        ) B                                                                                                         			");
		sql.append("	 		ON DATE_FORMAT(E.HOLI_DAY, '%Y/%m') = B.JUBSU_DATE                                                                      ");
		sql.append("	  	LEFT JOIN                                                                                                                   ");
		sql.append("	     	(                                                                                           							");
		sql.append("	     		SELECT JUBSU_DATE , COUNT(CNT)  SU                                                                                  ");
		sql.append("	        	FROM                                                                                                                ");
		sql.append("	        		(                                                                                                               ");
		sql.append("	              		SELECT DATE_FORMAT(Y.JUBSU_DATE, '%Y/%m') JUBSU_DATE, Y.DRG_BUNHO, SUM(1) CNT                               ");
		sql.append("	                	FROM DRG3011 Y JOIN DRG3010 X                                                                               ");
		sql.append("	                		ON X.HOSP_CODE = Y.HOSP_CODE                                                                            ");
		sql.append("	                 		AND X.FKDRG3011 = Y.PKDRG3011                                                                           ");
		sql.append("	               		WHERE Y.HOSP_CODE = :f_hosp_code                                                                            ");
		sql.append("	                 		AND Y.JUBSU_DATE BETWEEN STR_TO_DATE(CONCAT(:f_date, '0101'),'%Y%m%d')                                  ");
		sql.append("	                                      AND STR_TO_DATE(CONCAT(:f_date, '1231'),'%Y%m%d')                                         ");
		sql.append("	                        AND Y.BUNRYU1   = '4'                                                                                   ");
		sql.append("	                        AND Y.DRG_BUNHO IS NOT NULL                                                                             ");
		sql.append("	                        AND Y.HO_DONG   LIKE CONCAT(:f_ho_dong, '%')                                                            ");
		sql.append("	                        AND Y.BUNHO     NOT LIKE '09%'                                                                          ");
		sql.append("	                        AND IFNULL(X.BANNAB_YN, 'N') = 'N'                                                                      ");
		sql.append("	                        AND IFNULL(X.DC_YN, 'N')     = 'N'                                                                      ");
		sql.append("	               		GROUP BY Y.JUBSU_DATE, Y.DRG_BUNHO, Y.GROUP_SER                                                             ");
		sql.append("	             	) TMP                                                                                                           ");
		sql.append("	       		GROUP BY                                                                                                            ");
		sql.append("	        		TMP.JUBSU_DATE                                                                                                  ");
		sql.append("	        ) H                                                                                                         			");
		sql.append("	 		ON DATE_FORMAT(E.HOLI_DAY, '%Y/%m') = H.JUBSU_DATE                                                                      ");
		sql.append("	  	LEFT JOIN                                                                                                                   ");
		sql.append("	    	(                                                                                             							");
		sql.append("	     		SELECT JUBSU_DATE , SUM(CNT)  SU                                                                                    ");
		sql.append("	        	FROM                                                                                                                ");
		sql.append("	        		(                                                                                                               ");
		sql.append("	              		SELECT DATE_FORMAT(Y.JUBSU_DATE, '%Y/%m') JUBSU_DATE, Y.DRG_BUNHO, COUNT(Y.JAERYO_CODE) CNT                 ");
		sql.append("	                	FROM DRG3011 Y JOIN DRG3010 X                                                                               ");
		sql.append("	                		ON X.HOSP_CODE = Y.HOSP_CODE                                                                            ");
		sql.append("	                 		AND X.FKDRG3011 = Y.PKDRG3011                                                                           ");
		sql.append("	               		WHERE Y.HOSP_CODE = :f_hosp_code                                                                            ");
		sql.append("	                 		AND Y.JUBSU_DATE BETWEEN STR_TO_DATE(CONCAT(:f_date, '0101'),'%Y%m%d')                                  ");
		sql.append("	                                      AND STR_TO_DATE(CONCAT(:f_date, '1231'),'%Y%m%d')                                         ");
		sql.append("	                        AND Y.BUNRYU1   = '4'                                                                                   ");
		sql.append("	                        AND Y.DRG_BUNHO IS NOT NULL                                                                             ");
		sql.append("	                        AND Y.HO_DONG   LIKE CONCAT(:f_ho_dong, '%')                                                            ");
		sql.append("	                        AND Y.BUNHO     NOT LIKE '09%'                                                                          ");
		sql.append("	                        AND IFNULL(X.BANNAB_YN, 'N') = 'N'                                                                      ");
		sql.append("	                        AND IFNULL(X.DC_YN, 'N')     = 'N'                                                                      ");
		sql.append("	               		GROUP BY Y.JUBSU_DATE, Y.DRG_BUNHO                                                                          ");
		sql.append("	             	) TMP                                                                                                           ");
		sql.append("	       		GROUP BY                                                                                                            ");
		sql.append("	        		TMP.JUBSU_DATE                                                                                                  ");
		sql.append("	        ) D                                                                                                         			");
		sql.append("	 		ON DATE_FORMAT(E.HOLI_DAY, '%Y/%m') = D.JUBSU_DATE                                                                      ");
		sql.append("	WHERE                                                                                                                           ");
		sql.append("		E.HOLI_DAY BETWEEN STR_TO_DATE(CONCAT(:f_date, '01'),'%Y%m') AND LAST_DAY(STR_TO_DATE(CONCAT(:f_date, '12'),'%Y%m'))		");
		sql.append("	ORDER BY                                                                                                                        ");
		sql.append("		1                                                                                                                         	");
		
		Query query = entityManager.createNativeQuery(sql.toString());
		query.setParameter("f_hosp_code", hospCode);
		query.setParameter("f_date", date);
		query.setParameter("f_ho_dong", hoDong);
		
		List<DRG9001R04lay9001RInfo> listInfo = new JpaResultMapper().list(query, DRG9001R04lay9001RInfo.class);
		return listInfo;
	}
}

