package nta.med.data.dao.medi.ocs.impl;

import java.util.List;

import javax.persistence.EntityManager;
import javax.persistence.PersistenceContext;
import javax.persistence.Query;

import nta.med.core.domain.ocs.Ocs1003C;
import nta.med.core.infrastructure.mapper.JpaResultMapper;
import nta.med.data.dao.medi.ocs.Ocs1003cRepositoryCustom;
import nta.med.data.model.ihis.ocso.OcsoOCS1003P01GridReserOrderListInfo;
import nta.med.data.model.ihis.ocso.OcsoOCS1003P01LayoutQueryInfo;

public class Ocs1003cRepositoryImpl implements Ocs1003cRepositoryCustom {

	@PersistenceContext
	private EntityManager entityManager;

	@Override
	public List<OcsoOCS1003P01LayoutQueryInfo> getOcsoOCS1003P01LayoutQueryInfo(String language, String hospCode, String bunho, Double fkout1001,
			String queryGubun, String inputGubun, String groupCode){
		StringBuilder sql = new StringBuilder();
		
		sql.append("  SELECT A.FKOUT1001 IN_OUT_KEY,                                                                                                        			");
		sql.append("         A.PKOCS1003C PKOCSKEY,                                                                                                         			");
		sql.append("         A.BUNHO BUNHO,                                                                                                                 			");
		sql.append("         DATE_FORMAT(A.ORDER_DATE, '%Y/%m/%d') ORDER_DATE,                                                                              			");
		sql.append("         A.GWA GWA,                                                                                                                     			");
		sql.append("         A.DOCTOR DOCTOR,                                                                                                               			");
		sql.append("         A.DOCTOR RESIDENT,                                                                                                             			");
		sql.append("         A.NAEWON_TYPE NAEWON_TYPE,                                                                                                     			");
		sql.append("         E.JUBSU_NO JUBSU_NO,                                                                                                           			");
		sql.append("         A.INPUT_ID INPUT_ID,                                                                                                           			");
		sql.append("         A.INPUT_PART INPUT_PART,                                                                                                       			");
		sql.append("         A.GWA INPUT_GWA,                                                                                                               			");
		sql.append("         A.INPUT_ID INPUT_DOCTOR,                                                                                                       			");
		sql.append("         A.INPUT_GUBUN INPUT_GUBUN,                                                                                                     			");
		sql.append("         FN_OCS_LOAD_CODE_NAME('INPUT_GUBUN', A.INPUT_GUBUN, :hospCode, :language) INPUT_GUBUN_NAME,                                    			");
		sql.append("         A.GROUP_SER GROUP_SER,                                                                                                         			");
		sql.append("         A.INPUT_TAB INPUT_TAB,                                                                                                         			");
		sql.append("         FN_OCS_LOAD_CODE_NAME('INPUT_TAB', A.INPUT_TAB, :hospCode, :language) INPUT_TAB_NAME,                                          			");
		sql.append("         A.ORDER_GUBUN ORDER_GUBUN,                                                                                                     			");
		sql.append("         FN_OCS_LOAD_CODE_NAME('ORDER_GUBUN', A.ORDER_GUBUN, :hospCode, :language) ORDER_GUBUN_NAME,                                    			");
		sql.append("         B.GROUP_YN GROUP_YN,                                                                                                           			");
		sql.append("         A.SEQ SEQ,                                                                                                                     			");
		sql.append("         A.SLIP_CODE SLIP_CODE,                                                                                                         			");
		sql.append("         A.HANGMOG_CODE HANGMOG_CODE,                                                                                                   			");
		sql.append("         IF(A.GENERAL_DISP_YN = 'Y', I.GENERIC_NAME, B.HANGMOG_NAME) HANGMOG_NAME,                                                      			");
		sql.append("         A.SPECIMEN_CODE SPECIMEN_CODE,                                                                                                 			");
		sql.append("         IFNULL(C.SPECIMEN_NAME, '') SPECIMEN_NAME,                                                                                                 "); //
		sql.append("         A.SURYANG SURYANG,                                                                                                             			");
		sql.append("         A.SUNAB_SURYANG SUNAB_SURYANG,                                                                                                 			");
		sql.append("         A.SUBUL_SURYANG SUBUL_SURYANG,                                                                                                 			");
		sql.append("         A.ORD_DANUI ORD_DANUI,                                                                                                         			");
		sql.append("         FN_OCS_LOAD_CODE_NAME('ORD_DANUI', A.ORD_DANUI, :hospCode, :language) ORD_DANUI_NAME,                                          			");
		sql.append("         A.DV_TIME DV_TIME,                                                                                                             			");
		sql.append("         A.DV DV,                                                                                                                       			");
		sql.append("         A.DV_1 DV_1,                                                                                                                   			");
		sql.append("         A.DV_2 DV_2,                                                                                                                   			");
		sql.append("         A.DV_3 DV_3,                                                                                                                   			");
		sql.append("         A.DV_4 DV_4,                                                                                                                   			");
		sql.append("         A.NALSU NALSU,                                                                                                                 			");
		sql.append("         '' SUNAB_NALSU,                                                                                                              				");
		sql.append("         A.JUSA JUSA,                                                                                                                   			");
		sql.append("         FN_OCS_LOAD_CODE_NAME ('JUSA', A.JUSA, :hospCode, :language) JUSA_NAME,                                                        			");
		sql.append("         A.JUSA_SPD_GUBUN JUSA_SPD_GUBUN,                                                                                               			");
		sql.append("         A.BOGYONG_CODE BOGYONG_CODE,                                                                                                   			");
		sql.append("         CASE                                                                                                                           			");
		sql.append("            WHEN (B.INPUT_CONTROL = 'A')                                                                                                			");
		sql.append("            THEN                                                                                                                        			");
		sql.append("               FN_CHT_LOAD_CHT0117_NAME (A.BOGYONG_CODE, :hospCode, :language)                                                                 		");
		sql.append("            ELSE                                                                                                                        			");
		sql.append("               FN_DRG_LOAD_BOGYONG_NAME (A.BOGYONG_CODE, :hospCode)                                                                     			");
		sql.append("         END                                                                                                                            			");
		sql.append("            BOGYONG_NAME,                                                                                                               			");
		sql.append("         A.EMERGENCY EMERGENCY,                                                                                                         			");
		sql.append("         A.JAERYO_JUNDAL_YN JAERYO_JUNDAL_YN,                                                                                           			");
		sql.append("         A.JUNDAL_TABLE JUNDAL_TABLE,                                                                                                   			");
		sql.append("         A.JUNDAL_PART JUNDAL_PART,                                                                                                     			");
		sql.append("         A.MOVE_PART MOVE_PART,                                                                                                         			");
		sql.append("         A.PORTABLE_YN PORTABLE_YN,                                                                                                     			");
		sql.append("         A.POWDER_YN POWDER_YN,                                                                                                         			");
		sql.append("         A.HUBAL_CHANGE_YN HUBAL_CHANGE_YN,                                                                                             			");
		sql.append("         A.PHARMACY PHARMACY,                                                                                                           			");
		sql.append("         A.DRG_PACK_YN DRG_PACK_YN,                                                                                                     			");
		sql.append("         A.MUHYO MUHYO,                                                                                                                 			");
		sql.append("         '' PRN_YN,                                                                                                                     			");
		sql.append("         '' TOIWON_DRG_YN,                                                                                                              			");
		sql.append("         '' PRN_NURSE,                                                                                                                  			");
		sql.append("         '' APPEND_YN,                                                                                                                  			");
		sql.append("         A.ORDER_REMARK ORDER_REMARK,                                                                                                   			");
		sql.append("         A.NURSE_REMARK NURSE_REMARK,                                                                                                   			");
		sql.append("         '' COMMENTS,                                                                                                                   			");
		sql.append("         A.MIX_GROUP MIX_GROUP,                                                                                                         			");
		sql.append("         A.AMT AMT,                                                                                                                     			");
		sql.append("         A.PAY PAY,                                                                                                                     			");
		sql.append("         A.WONYOI_ORDER_YN WONYOI_ORDER_YN,                                                                                             			");
		sql.append("         A.DANGIL_GUMSA_ORDER_YN DANGIL_GUMSA_ORDER_YN,                                                                                 			");
		sql.append("         A.DANGIL_GUMSA_RESULT_YN DANGIL_GUMSA_RESULT_YN,                                                                               			");
		sql.append("         A.BOM_OCCUR_YN BOM_OCCUR_YN,                                                                                                   			");
		sql.append("         A.BOM_SOURCE_KEY BOM_SOURCE_KEY,                                                                                               			");
		sql.append("         A.DISPLAY_YN DISPLAY_YN,                                                                                                       			");
		sql.append("         A.SUNAB_YN SUNAB_YN,                                                                                                           			");
		sql.append("         DATE_FORMAT(A.SUNAB_DATE, '%Y/%m/%d') SUNAB_DATE,                                                                              			");
		sql.append("         A.SUNAB_TIME SUNAB_TIME,                                                                                                       			");
		sql.append("         DATE_FORMAT(A.HOPE_DATE, '%Y/%m/%d') HOPE_DATE,                                                                                			");
		sql.append("         A.HOPE_TIME HOPE_TIME,                                                                                                         			");
		sql.append("         A.NURSE_CONFIRM_USER NURSE_CONFIRM_USER,                                                                                       			");
		sql.append("         DATE_FORMAT(A.NURSE_CONFIRM_DATE, '%Y/%m/%d') NURSE_CONFIRM_DATE,                                                              			");
		sql.append("         A.NURSE_CONFIRM_TIME NURSE_CONFIRM_TIME,                                                                                       			");
		sql.append("         '' NURSE_PICKUP_USER,                                                                                                          			");
		sql.append("         '' NURSE_PICKUP_DATE,                                                                                                          			");
		sql.append("         '' NURSE_PICKUP_TIME,                                                                                                          			");
		sql.append("         '' NURSE_HOLD_USER,                                                                                                            			");
		sql.append("         '' NURSE_HOLD_DATE,                                                                                                            			");
		sql.append("         '' NURSE_HOLD_TIME,                                                                                                            			");
		sql.append("         DATE_FORMAT(A.RESER_DATE, '%Y/%m/%d') RESER_DATE,                                                                              			");
		sql.append("         A.RESER_TIME RESER_TIME,                                                                                                       			");
		sql.append("         DATE_FORMAT(A.JUBSU_DATE, '%Y/%m/%d') JUBSU_DATE,                                                                              			");
		sql.append("         A.JUBSU_TIME JUBSU_TIME,                                                                                                       			");
		sql.append("         DATE_FORMAT(A.ACTING_DATE, '%Y/%m/%d') ACTING_DATE,                                                                            			");
		sql.append("         A.ACTING_TIME ACTING_TIME,                                                                                                     			");
		sql.append("         A.ACTING_DAY ACTING_DAY,                                                                                                       			");
		sql.append("         DATE_FORMAT(A.RESULT_DATE, '%Y/%m/%d') RESULT_DATE,                                                                            			");
		sql.append("         A.DC_GUBUN DC_GUBUN,                                                                                                           			");
		sql.append("         A.DC_YN DC_YN,                                                                                                                 			");
		sql.append("         A.BANNAB_YN BANNAB_YN,                                                                                                         			");
		sql.append("         A.BANNAB_CONFIRM BANNAB_CONFIRM,                                                                                               			");
		sql.append("         A.SOURCE_FKOCS1003 SOURCE_ORD_KEY,                                                                                             			");
		sql.append("         A.OCS_FLAG OCS_FLAG,                                                                                                           			");
		sql.append("         A.SG_CODE SG_CODE,                                                                                                             			");
		sql.append("         A.SG_YMD SG_YMD,                                                                                                               			");
		sql.append("         A.IO_GUBUN IO_GUBUN,                                                                                                           			");
		sql.append("         A.AFTER_ACT_YN AFTER_ACT_YN,                                                                                                   			");
		sql.append("         A.BICHI_YN BICHI_YN,                                                                                                           			");
		sql.append("         A.DRG_BUNHO DRG_BUNHO,                                                                                                         			");
		sql.append("         A.SUB_SUSUL SUB_SUSUL,                                                                                                         			");
		sql.append("         A.PRINT_YN PRINT_YN,                                                                                                           			");
		sql.append("         A.CHISIK CHISIK,                                                                                                               			");
		sql.append("         A.TEL_YN TEL_YN,                                                                                                               			");
		sql.append("         B.ORDER_GUBUN ORDER_GUBUN_BAS,                                                                                                 			");
		sql.append("         B.INPUT_CONTROL INPUT_CONTROL,                                                                                                 			");
		sql.append("         B.SUGA_YN SUGA_YN,                                                                                                             			");
		sql.append("         B.JAERYO_YN JAERYO_YN,                                                                                                         			");
		sql.append("         IF(B.WONYOI_ORDER_YN = 'Z', 'Y', 'N') WONYOI_CHECK,                                                                            			");
		sql.append("         IF(IFNULL(B.EMERGENCY, 'Z') = 'Z', 'Y', IFNULL(B.EMERGENCY, 'Z')) EMERGENCY_CHECK,                                             			");
		sql.append("         B.SPECIMEN_YN SPECIMEN_CHECK,                                                                                                  			");
		sql.append("         B.PORTABLE_CHECK PORTABLE_CHECK,                                                                                               			");
		sql.append("         CASE                                                                                                                           			");
		sql.append("            WHEN (B.END_DATE IS NULL) THEN 'N'                                                                                          			");
		sql.append("            WHEN (B.END_DATE = DATE_FORMAT('99981231', '%Y%m%d')) THEN 'N'                                                              			");
		sql.append("            ELSE 'Y'                                                                                                                    			");
		sql.append("         END                                                                                                                            			");
		sql.append("            BULYONG_CHECK,                                                                                                              			");
		sql.append("         IF(A.SUNAB_DATE IS NULL, 'N', 'Y') SUNAB_CHECK,                                                                                			");
		sql.append("         IF(SIGN(A.NALSU) =  1 OR SIGN(A.NALSU) = 0, 'N',  'Y') DC_CHECK,                                                               			");
		sql.append("         A.DC_GUBUN DC_GUBUN_CHECK,                                                                                                     			");
		sql.append("         IF(A.NURSE_CONFIRM_DATE IS NULL, 'N', 'Y') CONFIRM_CHECK,                                                                      			");
		sql.append("         IF(A.RESER_DATE IS NULL, 'N', 'Y') RESER_YN_CHECK,                                                                             			");
		sql.append("         IF(A.CHISIK = '', 'N', 'Y') CHISIK_YN,                                                                                         			");
		sql.append("         A.NDAY_YN NDAY_YN,                                                                                                             			");
		sql.append("         FN_OCS_LOAD_JAERYO_JUNDAL_YN (:hospCode,'O', A.INPUT_PART, A.HANGMOG_CODE) DEFAULT_JAERYO_JUNDAL_YN,                           			");
		sql.append("         CASE                                                                                                                           			");
		sql.append("            WHEN (   A.ORDER_GUBUN NOT IN ('A', 'B', 'C', 'D')                                                                          			");
		sql.append("                  OR A.WONYOI_ORDER_YN = 'Z'                                                                                            			");
		sql.append("                  OR A.WONYOI_ORDER_YN = 'Y')                                                                                           			");
		sql.append("            THEN                                                                                                                        			");
		sql.append("               'N'                                                                                                                      			");
		sql.append("            ELSE                                                                                                                        			");
		sql.append("               'Y'                                                                                                                      			");
		sql.append("         END                                                                                                                            			");
		sql.append("            DEFAULT_WONYOI_YN,                                                                                                          			");
		sql.append("         IFNULL(D.SPECIFIC_COMMENT, '') SPECIFIC_COMMENT,                                                                                           ");//
		sql.append("         IFNULL(D.SPECIFIC_COMMENT_NAME, '') SPECIFIC_COMMENT_NAME,                                                                                 ");//
		sql.append("         IFNULL(D.SPECIFIC_COMMENT_SYS_ID, '') SPECIFIC_COMMENT_SYS_ID,                                                                             ");//
		sql.append("         IFNULL(D.SPECIFIC_COMMENT_PGM_ID, '') SPECIFIC_COMMENT_PGM_ID,                                                                             ");//
		sql.append("         IFNULL(D.SPECIFIC_COMMENT_NOT_NULL, '') SPECIFIC_COMMENT_NOT_NULL,                                                                         ");//
		sql.append("         IFNULL(D.SPECIFIC_COMMENT_TABLE_ID, '') SPECIFIC_COMMENT_TABLE_ID,                                                                         ");//
		sql.append("         IFNULL(D.SPECIFIC_COMMENT_COL_ID, '') SPECIFIC_COMMENT_COL_ID,                                                                            	");//
		sql.append("         FN_DRG_LOAD_DONBOK_YN (A.BOGYONG_CODE, :hospCode) DONBOG_YN,                                                                   			");
		sql.append("         FN_OCS_LOAD_CODE_NAME ('ORDER_GUBUN_BAS', SUBSTR(A.ORDER_GUBUN, 2, 1), :hospCode, :language) ORDER_GUBUN_BAS_NAME,             			");
		sql.append("         A.ACT_DOCTOR ACT_DOCTOR,                                                                                                       			");
		sql.append("         A.ACT_BUSEO ACT_BUSEO,                                                                                                         			");
		sql.append("         A.ACT_GWA ACT_GWA,                                                                                                             			");
		sql.append("         A.HOME_CARE_YN HOME_CARE_YN,                                                                                                   			");
		sql.append("         A.REGULAR_YN REGULAR_YN,                                                                                                       			");
		sql.append("         A.SORT_FKOCSKEY SORT_FKOCSKEY,                                                                                                 			");
		sql.append("         CASE                                                                                                                           			");
		sql.append("            WHEN (IF(A.BOM_SOURCE_KEY IS NULL, FN_OCS_LOAD_CHILD_GUBUN(A.HOSP_CODE, 'O', A.PKOCS1003C),												");
		sql.append("                          '3') != '3') THEN 'N'                                                                                         			");
		sql.append("            ELSE 'Y'                                                                                                                    			");
		sql.append("         END                                                                                                                            			");
		sql.append("            CHILD_YN,                                                                                                                   			");
		sql.append("         B.IF_INPUT_CONTROL IF_INPUT_CONTROL,                                                                                           			");
		sql.append("         F.SLIP_NAME SLIP_NAME,                                                                                                         			");
		sql.append("         A.PKOCS1003C ORG_KEY,                                                                                                          			");
		sql.append("         A.BOM_SOURCE_KEY PARENT_KEY,                                                                                                   			");
		sql.append("         G.BUN_CODE BUN_CODE,                                                                                                           			");
		sql.append("         CASE                                                                                                                           			");
		sql.append("            WHEN (B.ORDER_GUBUN IN ('B', 'C', 'D'))                                                                                     			");
		sql.append("            THEN                                                                                                                        			");
		sql.append("               IFNULL(B.WONNAE_DRG_YN, 'N')                                                                                             			");
		sql.append("            ELSE                                                                                                                        			");
		sql.append("               '%'                                                                                                                      			");
		sql.append("         END                                                                                                                            			");
		sql.append("            WONNAE_DRG_YN,                                                                                                              			");
		sql.append("         ' ' HUBAL_CHANGE_CHECK,                                                                                                        			");
		sql.append("         ' ' DRG_PACK_CHECK,                                                                                                            			");
		sql.append("         ' ' PHARMACY_CHECK,                                                                                                            			");
		sql.append("         ' ' POWER_CHECK,                                                                                                               			");
		sql.append("         IFNULL(A.IMSI_DRUG_YN, 'N') IMSI_DRUG_YN,                                                                                      			");
		sql.append("         IFNULL(A.GENERAL_DISP_YN, 'N') GENERAL_DISP_YN,                                                                                			");
		sql.append("         A.DV_5 DV_5,                                                                                                                   			");
		sql.append("         A.DV_6 DV_6,                                                                                                                   			");
		sql.append("         A.DV_7 DV_7,                                                                                                                   			");
		sql.append("         A.DV_8 DV_8,                                                                                                                   			");
		sql.append("         A.BOGYONG_CODE_SUB BOGYONG_CODE_SUB,                                                                                           			");
		sql.append("         CASE                                                                                                                           			");
		sql.append("            WHEN (   SUBSTR(A.ORDER_GUBUN, 2) = 'A'                                                                                     			");
		sql.append("                  OR SUBSTR(A.ORDER_GUBUN, 2) = 'B'                                                                                     			");
		sql.append("                  OR SUBSTR(A.ORDER_GUBUN, 2) = 'D')                                                                                    			");
		sql.append("            THEN                                                                                                                        			");
		sql.append("               FN_CHT_LOAD_CHT0117_NAME(A.BOGYONG_CODE_SUB, :hospCode, :language)                                                          			");
		sql.append("            ELSE                                                                                                                        			");
		sql.append("               FN_DRG_LOAD_BOGYONG_NAME(A.BOGYONG_CODE_SUB, :hospCode)                                                                  			");
		sql.append("         END                                                                                                                            			");
		sql.append("            BOGYONG_NAME_SUB,                                                                                                           			");
		sql.append("         B.LIMIT_NALSU LIMIT_NALSU,                                                                                                     			");
		sql.append("         B.LIMIT_SURYANG LIMIT_SURYANG,                                                                                                 			");
		sql.append("         J.GWA_NAME GWA_NAME,                                                                                                           			");
		sql.append("         IFNULL(A.INSTEAD_YN, 'N') INSTEAD_YN,                                                                                          			");
		sql.append("         IFNULL(A.APPROVE_YN, 'N') APPROVE_YN,                                                                                          			");
		sql.append("         IFNULL(A.POSTAPPROVE_YN, 'N') POSTAPPROVE_YN,                                                                                  			");
		sql.append("         FN_OCS_LOAD_ORDER_SORT_KEY ('O', A.PKOCS1003C,:hospCode) ORDER_BY_KEY,                                                           			");
		sql.append("		 'N'	AS ACTION_DO_YN																														");
		sql.append("    FROM                                                                                                                                			");
		sql.append("         OCS1003C A                                                                                                                      			");
		sql.append("         LEFT JOIN OCS0116 C ON C.HOSP_CODE = A.HOSP_CODE AND C.SPECIMEN_CODE = A.SPECIMEN_CODE                                         			");
		sql.append("         INNER JOIN OUT1001 E ON E.HOSP_CODE = A.HOSP_CODE AND E.PKOUT1001 = A.FKOUT1001                                                			");
		sql.append("         INNER JOIN OCS0102 F ON F.HOSP_CODE = A.HOSP_CODE AND A.SLIP_CODE = F.SLIP_CODE AND F.LANGUAGE = :language									");
		sql.append("         INNER JOIN BAS0260 J ON J.HOSP_CODE = A.HOSP_CODE AND J.GWA = A.JUNDAL_PART  AND J.LANGUAGE = :language                        			");
		sql.append("         , OCS0103 B                                                                                                                   				");
		sql.append("         LEFT JOIN OCS0170 D ON D.HOSP_CODE = B.HOSP_CODE AND D.SPECIFIC_COMMENT = B.SPECIFIC_COMMENT												");
		sql.append("         LEFT JOIN (SELECT A.SG_CODE,                                                                                                   			");
		sql.append("                 A.SG_NAME,                                                                                                             			");
		sql.append("                 A.BUN_CODE,                                                                                                            			");
		sql.append("                 A.HOSP_CODE                                                                                                            			");
		sql.append("            FROM BAS0310 A                                                                                                              			");
		sql.append("           WHERE A.HOSP_CODE = :hospCode                                                                                                			");
		sql.append("             AND A.SG_CODE IN (SELECT SG_CODE FROM OCS1003C WHERE HOSP_CODE = :hospCode AND BUNHO = :bunho AND FKOUT1001 = :fkout1001)  			");
		sql.append("             AND A.SG_YMD =                                                                                                             			");
		sql.append("                    (SELECT MAX(Z.SG_YMD)                                                                                               			");
		sql.append("                       FROM BAS0310 Z                                                                                                   			");
		sql.append("                      WHERE Z.HOSP_CODE = A.HOSP_CODE                                                                                   			");
		sql.append("                            AND Z.SG_CODE = A.SG_CODE																                    			");
		sql.append("                            AND Z.SG_YMD <= SYSDATE())) G ON G.HOSP_CODE = :hospCode AND G.SG_CODE = B.SG_CODE                        				");
		sql.append(" LEFT JOIN ( select distinct B.HOSP_CODE AS HOSP_CODE ,A.HANGMOG_CODE AS HANGMOG_CODE, C.GENERIC_NAME AS GENERIC_NAME                   			");
		sql.append("               FROM OCS0109 C INNER JOIN OCS0110 B ON C.HOSP_CODE = B.HOSP_CODE AND C.GENERIC_CODE_ORG = B.GENERIC_CODE_ORG             			");
		sql.append("                              INNER JOIN OCS0103 A ON B.HOSP_CODE = A.HOSP_CODE AND B.YAK_KIJUN_CODE = A.YAK_KIJUN_CODE								");
		sql.append("                              WHERE  B.HOSP_CODE = :hospCode                                                                            			");
		sql.append("            union all                                                                                                                   			");
		sql.append("            select distinct C.HOSP_CODE AS HOSP_CODE ,A.HANGMOG_CODE AS HANGMOG_CODE, C.GENERIC_NAME AS GENERIC_NAME                    			");
		sql.append("            FROM OCS0109 C INNER JOIN OCS0103 A ON C.HOSP_CODE = A.HOSP_CODE AND C.GENERIC_CODE = A.YAK_KIJUN_CODE_SHORT						    ");
		sql.append("            WHERE C.HOSP_CODE = :hospCode AND                                                                                           			");
		sql.append("                 (not (exists(SELECT NULL FROM OCS0110 Z                                                                                			");
		sql.append("                                WHERE Z.HOSP_CODE = C.HOSP_CODE AND                                                                     			");
		sql.append("                                Z.YAK_KIJUN_CODE = A.YAK_KIJUN_CODE)))) I                                                               			");
		sql.append("                           ON I.HOSP_CODE = :hospCode AND I.HANGMOG_CODE = B.HANGMOG_CODE										    				");
		sql.append("   WHERE  A.HOSP_CODE = :hospCode                                                                                                       			");
		sql.append("		 AND B.HOSP_CODE = :hospCode																												");
		sql.append("         AND A.BUNHO = :bunho                                                                                                           			");
		sql.append("         AND A.FKOUT1001 = :fkout1001                                                                                                   			");
		sql.append("         AND (IFNULL(A.INSTEAD_YN, 'N') = 'N'                                                                                           			");
		sql.append("              OR (IFNULL(A.INSTEAD_YN, 'N') = 'Y'                                                                                       			");
		sql.append("                  AND IFNULL(A.APPROVE_YN, 'N') LIKE                                                                                    			");
		sql.append("                         IF(:queryGubun = 'Y', 'Y', '%')))                                                                              			");
		sql.append("         AND ( (:queryGubun = 'D' AND A.INPUT_GUBUN LIKE 'D%')                                                                          			");
		sql.append("              OR (:queryGubun != 'D'                                                                                                    			");
		sql.append("                  AND (A.INPUT_GUBUN LIKE 'D%'                                                                                          			");
		sql.append("                       OR A.INPUT_GUBUN = :inputGubun)))                                                                                			");
		sql.append("         AND A.HOSP_CODE = :hospCode	                                                                                                  			");
		sql.append("         AND B.HANGMOG_CODE = A.HANGMOG_CODE                                                                                            			");
		sql.append("         AND A.ORDER_DATE BETWEEN B.START_DATE AND B.END_DATE                                                                           			");
		sql.append("         AND J.LANGUAGE = :language                                                                                                     			");
		sql.append("ORDER BY CASE WHEN ORDER_BY_KEY IS NULL THEN A.PKOCS1003C  ELSE ORDER_BY_KEY END                                                         			");
		
		Query query = entityManager.createNativeQuery(sql.toString());
		query.setParameter("hospCode", hospCode);
		query.setParameter("language", language);
		query.setParameter("bunho", bunho);
		query.setParameter("fkout1001", fkout1001);
		query.setParameter("queryGubun", queryGubun);
		query.setParameter("inputGubun", inputGubun);
		//query.setParameter("groupCode", groupCode);
		List<OcsoOCS1003P01LayoutQueryInfo> list = new JpaResultMapper().list(query, OcsoOCS1003P01LayoutQueryInfo.class);

		return list;
	}
	
	@Override
	public List<OcsoOCS1003P01GridReserOrderListInfo> getOcsoOCS1003P01GridReserOrderList(
			String language, String hospCode, String bunho, String naewonDate) {
		StringBuilder sql = new StringBuilder();
		sql.append(" SELECT   KIZYUN_DATE,                                                                                       ");
		sql.append("          GWA,                                                                                               ");
		sql.append("          GWA_NAME,                                                                                          ");
		sql.append("          DOCTOR,                                                                                            ");
		sql.append("          DOCTOR_NAME,                                                                                       ");
		sql.append("          HANGMOG_CODE,                                                                                      ");
		sql.append("          HANGMOG_NAME,                                                                                      ");
		sql.append("          JUNDAL_TABLE,                                                                                      ");
		sql.append("          JUNDAL_PART,                                                                                       ");
		sql.append("          JUNDAL_PART_NAME,                                                                                  ");
		sql.append("          RESER_TIME,                                                                                        ");
		sql.append("          RESER_YN,                                                                                          ");
		sql.append("          ACT_YN,                                                                                            ");
		sql.append("          ORDER_DATE,                                                                                        ");
		sql.append("          PKSCH                                                                                              ");
		sql.append("     FROM (SELECT A.RESER_DATE AS KIZYUN_DATE,                                                               ");
		sql.append("                  A.GWA AS GWA,                                                                              ");
		sql.append("                  FN_BAS_LOAD_GWA_NAME(A.GWA, A.INPUT_DATE, :hospCode, :language) AS GWA_NAME,               ");
		sql.append("                  A.DOCTOR AS DOCTOR,                                                                        ");
		sql.append("                  FN_BAS_LOAD_DOCTOR_NAME(A.DOCTOR, A.ORDER_DATE, :hospCode)                                 ");
		sql.append("                     AS DOCTOR_NAME,                                                                         ");
		sql.append("                  A.HANGMOG_CODE AS HANGMOG_CODE,                                                            ");
		sql.append("                  B.HANGMOG_NAME AS HANGMOG_NAME,                                                            ");
		sql.append("                  A.JUNDAL_TABLE AS JUNDAL_TABLE,                                                            ");
		sql.append("                  A.JUNDAL_PART AS JUNDAL_PART,                                                              ");
		sql.append("                  C.JUNDAL_PART_NAME AS JUNDAL_PART_NAME,                                                    ");
		sql.append("                  A.RESER_TIME AS RESER_TIME,                                                                ");
		sql.append("                  IF(A.RESER_DATE = NULL, 'N', 'Y') AS RESER_YN,                                             ");
		sql.append("                  IF(A.ACTING_DATE = NULL, 'N', 'Y') AS ACT_YN,                                              ");
		sql.append("                  A.ORDER_DATE AS ORDER_DATE,                                                                ");
		sql.append("                  A.PKSCH0201 AS PKSCH                                                                       ");
		sql.append("             FROM SCH0201 A,                                                                                 ");
		sql.append("                  OCS0103 B,                                                                                ");
		sql.append("                  SCH0001 C,                                                                                 ");
		sql.append("                  OCS1003C D                                                                                 ");
		sql.append("            WHERE     A.HOSP_CODE = :hospCode                                                                ");
		sql.append("                  AND A.BUNHO = :bunho                                                                       ");
		sql.append("                  AND A.RESER_DATE = DATE_FORMAT(:naewonDate,'%Y/%m/%d')                                     ");
		sql.append("                  AND A.IN_OUT_GUBUN = 'O'                                                                   ");
		sql.append("                  AND A.JUNDAL_TABLE <> 'PHY'                                                                ");
		sql.append("                  AND IFNULL(A.CANCEL_YN, 'N') = 'N'                                                         ");
		sql.append("                  AND B.HOSP_CODE = A.HOSP_CODE                                                          	 ");
		sql.append("                  AND B.COMMON_YN = 'Y'																		 ");
		sql.append("                  AND B.HANGMOG_CODE = A.HANGMOG_CODE                                                        ");
		sql.append("                  AND DATE_FORMAT(:naewonDate,'%Y/%m/%d') BETWEEN B.START_DATE AND B.END_DATE                ");
		sql.append("                  AND C.HOSP_CODE = A.HOSP_CODE                                                              ");
		sql.append("                  AND C.JUNDAL_TABLE = A.JUNDAL_TABLE                                                        ");
		sql.append("                  AND C.JUNDAL_PART = A.JUNDAL_PART                                                          ");
		sql.append("                                                                                                             ");
		sql.append("                  AND D.HOSP_CODE = A.HOSP_CODE                                                              ");
		sql.append("                  AND D.PKOCS1003C = A.FKOCS                                                                 ");
		sql.append("                  AND ( (IFNULL(D.INSTEAD_YN, 'N') = 'N')                                                    ");
		sql.append("                       OR (IFNULL(D.INSTEAD_YN, 'N') = 'Y'                                                   ");
		sql.append("                           AND IFNULL(D.APPROVE_YN, 'N') = 'Y'))                                             ");
		sql.append("           UNION ALL                                                                                         ");
		sql.append("           SELECT B.RESER_DATE AS KIZYUN_DATE,                                                               ");
		sql.append("                  A.GWA AS GWA,                                                                              ");
		sql.append("                  FN_BAS_LOAD_GWA_NAME (A.GWA, B.RESER_DATE, :hospCode, :language) AS GWA_NAME,              ");
		sql.append("                  A.DOCTOR AS DOCTOR,                                                                        ");
		sql.append("                  FN_BAS_LOAD_DOCTOR_NAME (A.DOCTOR, B.RESER_DATE, :hospCode)                                ");
		sql.append("                     AS DOCTOR_NAME,                                                                         ");
		sql.append("                  B.HANGMOG_CODE AS HANGMOG_CODE,                                                            ");
		sql.append("                  C.HANGMOG_NAME AS HANGMOG_NAME,                                                            ");
		sql.append("                  'INJ' AS JUNDAL_TABLE,                                                                     ");
		sql.append("                  A.JUNDAL_PART AS JUNDAL_PART,                                                              ");
		sql.append("                  D.BUSEO_NAME AS JUNDAL_PART_NAME,                                                          ");
		sql.append("                  B.RESER_TIME AS RESER_TIME,                                                                ");
		sql.append("                  IF(B.RESER_DATE= NULL, 'N', 'Y') AS RESER_YN,                                              ");
		sql.append("                  IF(B.ACTING_DATE = NULL, 'N', 'Y') AS ACT_YN,                                              ");
		sql.append("                  A.ORDER_DATE AS ORDER_DATE,                                                                ");
		sql.append("                  B.PKINJ1002 AS PKSCH                                                                       ");
		sql.append("             FROM BAS0260 D,                                                                                 ");
		sql.append("                  OCS0103 C,                                                                                ");
		sql.append("                  INJ1002 B,                                                                                 ");
		sql.append("                  INJ1001 A,                                                                                 ");
		sql.append("                  OCS1003C E                                                                                 ");
		sql.append("            WHERE     A.HOSP_CODE = :hospCode                                                                ");
		sql.append("                  AND A.BUNHO = null                                                                         ");
		sql.append("                  AND B.HOSP_CODE = A.HOSP_CODE                                                              ");
		sql.append("                  AND B.FKINJ1001 = A.PKINJ1001                                                              ");
		sql.append("                  AND A.ORDER_DATE <> B.RESER_DATE                                                           ");
		sql.append("                  AND B.RESER_DATE = DATE_FORMAT(null,'%Y/%m/%d')                                            ");
		sql.append("                  AND IFNULL(B.DC_YN, 'N') = 'N'                                                             ");
		sql.append("                  AND C.HOSP_CODE = B.HOSP_CODE                                                              ");
		sql.append("                  AND C.COMMON_YN = 'Y'                                                              		 "); // uncheck
		sql.append("                  AND C.HANGMOG_CODE = B.HANGMOG_CODE                                                        ");
		sql.append("                  AND DATE_FORMAT(null,'%Y/%m/%d') BETWEEN C.START_DATE AND C.END_DATE                       ");
		sql.append("                  AND D.HOSP_CODE = A.HOSP_CODE                                                              ");
		sql.append("                  AND D.GWA = A.JUNDAL_PART                                                                  ");
		sql.append("                  AND D.LANGUAGE = :language                                                                 ");
		sql.append("                  AND DATE_FORMAT(null,'%Y/%m/%d') BETWEEN D.START_DATE AND D.END_DATE                       ");
		sql.append("                                                                                                             ");
		sql.append("                  AND E.HOSP_CODE = A.HOSP_CODE                                                              ");
		sql.append("                  AND E.PKOCS1003C = A.FKOCS1003                                                             ");
		sql.append("                  AND ( (IFNULL(E.INSTEAD_YN, 'N') = 'N')                                                    ");
		sql.append("                       OR (IFNULL(E.INSTEAD_YN, 'N') = 'Y'                                                   ");
		sql.append("                           AND IFNULL(E.APPROVE_YN, 'N') = 'Y'))) A                                          ");
		sql.append(" ORDER BY KIZYUN_DATE,                                                                                       ");
		sql.append("          ORDER_DATE,                                                                                        ");
		sql.append("          GWA,                                                                                               ");
		sql.append("          DOCTOR,                                                                                            ");
		sql.append("          JUNDAL_TABLE,                                                                                      ");
		sql.append("          JUNDAL_PART,                                                                                       ");
		sql.append("          RESER_TIME,                                                                                        ");
		sql.append("          RESER_YN                                                                                           ");

		Query query = entityManager.createNativeQuery(sql.toString());
		query.setParameter("hospCode", hospCode);
		query.setParameter("language", language);
		query.setParameter("bunho", bunho);
		query.setParameter("naewonDate", naewonDate);
		
		List<OcsoOCS1003P01GridReserOrderListInfo> list = new JpaResultMapper()
				.list(query, OcsoOCS1003P01GridReserOrderListInfo.class);

		return list;
	}

	@Override
	public List<OcsoOCS1003P01LayoutQueryInfo> getOcsoOCS1003P01LayoutQueryInfo(String language, String hospCode, String bunho, Double fkout1001,
			String queryGubun, String inputGubun){
		StringBuilder sql = new StringBuilder();
		sql.append("  SELECT A.FKOUT1001 IN_OUT_KEY,                                                                                                        ");
		sql.append("         A.PKOCS1003C PKOCSKEY,                                                                                                         ");
		sql.append("         A.BUNHO BUNHO,                                                                                                                 ");
		sql.append("         DATE_FORMAT(A.ORDER_DATE, '%Y/%m/%d') ORDER_DATE,                                                                              ");
		sql.append("         A.GWA GWA,                                                                                                                     ");
		sql.append("         A.DOCTOR DOCTOR,                                                                                                               ");
		sql.append("         A.DOCTOR RESIDENT,                                                                                                             ");
		sql.append("         A.NAEWON_TYPE NAEWON_TYPE,                                                                                                     ");
		sql.append("         E.JUBSU_NO JUBSU_NO,                                                                                                           ");
		sql.append("         A.INPUT_ID INPUT_ID,                                                                                                           ");
		sql.append("         A.INPUT_PART INPUT_PART,                                                                                                       ");
		sql.append("         A.GWA INPUT_GWA,                                                                                                               ");
		sql.append("         A.INPUT_ID INPUT_DOCTOR,                                                                                                       ");
		sql.append("         A.INPUT_GUBUN INPUT_GUBUN,                                                                                                     ");
		sql.append("         FN_OCS_LOAD_CODE_NAME('INPUT_GUBUN', A.INPUT_GUBUN, :hospCode, :language) INPUT_GUBUN_NAME,                                    ");
		sql.append("         A.GROUP_SER GROUP_SER,                                                                                                         ");
		sql.append("         A.INPUT_TAB INPUT_TAB,                                                                                                         ");
		sql.append("         FN_OCS_LOAD_CODE_NAME('INPUT_TAB', A.INPUT_TAB, :hospCode, :language) INPUT_TAB_NAME,                                          ");
		sql.append("         A.ORDER_GUBUN ORDER_GUBUN,                                                                                                     ");
		sql.append("         FN_OCS_LOAD_CODE_NAME('ORDER_GUBUN', A.ORDER_GUBUN, :hospCode, :language) ORDER_GUBUN_NAME,                                    ");
		sql.append("         B.GROUP_YN GROUP_YN,                                                                                                           ");
		sql.append("         A.SEQ SEQ,                                                                                                                     ");
		sql.append("         A.SLIP_CODE SLIP_CODE,                                                                                                         ");
		sql.append("         A.HANGMOG_CODE HANGMOG_CODE,                                                                                                   ");
		sql.append("         IF(A.GENERAL_DISP_YN = 'Y', I.GENERIC_NAME, B.HANGMOG_NAME) HANGMOG_NAME,                                                      ");
		sql.append("         A.SPECIMEN_CODE SPECIMEN_CODE,                                                                                                 ");
		sql.append("         C.SPECIMEN_NAME SPECIMEN_NAME,                                                                                                 ");
		sql.append("         A.SURYANG SURYANG,                                                                                                             ");
		sql.append("         A.SUNAB_SURYANG SUNAB_SURYANG,                                                                                                 ");
		sql.append("         A.SUBUL_SURYANG SUBUL_SURYANG,                                                                                                 ");
		sql.append("         A.ORD_DANUI ORD_DANUI,                                                                                                         ");
		sql.append("         FN_OCS_LOAD_CODE_NAME('ORD_DANUI', A.ORD_DANUI, :hospCode, :language) ORD_DANUI_NAME,                                          ");
		sql.append("         A.DV_TIME DV_TIME,                                                                                                             ");
		sql.append("         A.DV DV,                                                                                                                       ");
		sql.append("         A.DV_1 DV_1,                                                                                                                   ");
		sql.append("         A.DV_2 DV_2,                                                                                                                   ");
		sql.append("         A.DV_3 DV_3,                                                                                                                   ");
		sql.append("         A.DV_4 DV_4,                                                                                                                   ");
		sql.append("         A.NALSU NALSU,                                                                                                                 ");
		sql.append("         '' SUNAB_NALSU,                                                                                                              	");
		sql.append("         A.JUSA JUSA,                                                                                                                   ");
		sql.append("         FN_OCS_LOAD_CODE_NAME ('JUSA', A.JUSA, :hospCode, :language) JUSA_NAME,                                                        ");
		sql.append("         A.JUSA_SPD_GUBUN JUSA_SPD_GUBUN,                                                                                               ");
		sql.append("         A.BOGYONG_CODE BOGYONG_CODE,                                                                                                   ");
		sql.append("         CASE                                                                                                                           ");
		sql.append("            WHEN (B.INPUT_CONTROL = 'A')                                                                                                ");
		sql.append("            THEN                                                                                                                        ");
		sql.append("               FN_CHT_LOAD_CHT0117_NAME (A.BOGYONG_CODE, :hospCode, :language)                                                          ");
		sql.append("            ELSE                                                                                                                        ");
		sql.append("               FN_DRG_LOAD_BOGYONG_NAME (A.BOGYONG_CODE, :hospCode)                                                                     ");
		sql.append("         END                                                                                                                            ");
		sql.append("            BOGYONG_NAME,                                                                                                               ");
		sql.append("         A.EMERGENCY EMERGENCY,                                                                                                         ");
		sql.append("         A.JAERYO_JUNDAL_YN JAERYO_JUNDAL_YN,                                                                                           ");
		sql.append("         A.JUNDAL_TABLE JUNDAL_TABLE,                                                                                                   ");
		sql.append("         A.JUNDAL_PART JUNDAL_PART,                                                                                                     ");
		sql.append("         A.MOVE_PART MOVE_PART,                                                                                                         ");
		sql.append("         A.PORTABLE_YN PORTABLE_YN,                                                                                                     ");
		sql.append("         A.POWDER_YN POWDER_YN,                                                                                                         ");
		sql.append("         A.HUBAL_CHANGE_YN HUBAL_CHANGE_YN,                                                                                             ");
		sql.append("         A.PHARMACY PHARMACY,                                                                                                           ");
		sql.append("         A.DRG_PACK_YN DRG_PACK_YN,                                                                                                     ");
		sql.append("         A.MUHYO MUHYO,                                                                                                                 ");
		sql.append("         '' PRN_YN,                                                                                                                     ");
		sql.append("         '' TOIWON_DRG_YN,                                                                                                              ");
		sql.append("         '' PRN_NURSE,                                                                                                                  ");
		sql.append("         '' APPEND_YN,                                                                                                                  ");
		sql.append("         A.ORDER_REMARK ORDER_REMARK,                                                                                                   ");
		sql.append("         A.NURSE_REMARK NURSE_REMARK,                                                                                                   ");
		sql.append("         '' COMMENTS,                                                                                                                   ");
		sql.append("         A.MIX_GROUP MIX_GROUP,                                                                                                         ");
		sql.append("         A.AMT AMT,                                                                                                                     ");
		sql.append("         A.PAY PAY,                                                                                                                     ");
		sql.append("         A.WONYOI_ORDER_YN WONYOI_ORDER_YN,                                                                                             ");
		sql.append("         A.DANGIL_GUMSA_ORDER_YN DANGIL_GUMSA_ORDER_YN,                                                                                 ");
		sql.append("         A.DANGIL_GUMSA_RESULT_YN DANGIL_GUMSA_RESULT_YN,                                                                               ");
		sql.append("         A.BOM_OCCUR_YN BOM_OCCUR_YN,                                                                                                   ");
		sql.append("         A.BOM_SOURCE_KEY BOM_SOURCE_KEY,                                                                                               ");
		sql.append("         A.DISPLAY_YN DISPLAY_YN,                                                                                                       ");
		sql.append("         A.SUNAB_YN SUNAB_YN,                                                                                                           ");
		sql.append("         DATE_FORMAT(A.SUNAB_DATE, '%Y/%m/%d') SUNAB_DATE,                                                                              ");
		sql.append("         A.SUNAB_TIME SUNAB_TIME,                                                                                                       ");
		sql.append("         DATE_FORMAT(A.HOPE_DATE, '%Y/%m/%d') HOPE_DATE,                                                                                ");
		sql.append("         A.HOPE_TIME HOPE_TIME,                                                                                                         ");
		sql.append("         A.NURSE_CONFIRM_USER NURSE_CONFIRM_USER,                                                                                       ");
		sql.append("         DATE_FORMAT(A.NURSE_CONFIRM_DATE, '%Y/%m/%d') NURSE_CONFIRM_DATE,                                                              ");
		sql.append("         A.NURSE_CONFIRM_TIME NURSE_CONFIRM_TIME,                                                                                       ");
		sql.append("         '' NURSE_PICKUP_USER,                                                                                                          ");
		sql.append("         '' NURSE_PICKUP_DATE,                                                                                                          ");
		sql.append("         '' NURSE_PICKUP_TIME,                                                                                                          ");
		sql.append("         '' NURSE_HOLD_USER,                                                                                                            ");
		sql.append("         '' NURSE_HOLD_DATE,                                                                                                            ");
		sql.append("         '' NURSE_HOLD_TIME,                                                                                                            ");
		sql.append("         DATE_FORMAT(A.RESER_DATE, '%Y/%m/%d') RESER_DATE,                                                                              ");
		sql.append("         A.RESER_TIME RESER_TIME,                                                                                                       ");
		sql.append("         DATE_FORMAT(A.JUBSU_DATE, '%Y/%m/%d') JUBSU_DATE,                                                                              ");
		sql.append("         A.JUBSU_TIME JUBSU_TIME,                                                                                                       ");
		sql.append("         DATE_FORMAT(A.ACTING_DATE, '%Y/%m/%d') ACTING_DATE,                                                                            ");
		sql.append("         A.ACTING_TIME ACTING_TIME,                                                                                                     ");
		sql.append("         A.ACTING_DAY ACTING_DAY,                                                                                                       ");
		sql.append("         DATE_FORMAT(A.RESULT_DATE, '%Y/%m/%d') RESULT_DATE,                                                                            ");
		sql.append("         A.DC_GUBUN DC_GUBUN,                                                                                                           ");
		sql.append("         A.DC_YN DC_YN,                                                                                                                 ");
		sql.append("         A.BANNAB_YN BANNAB_YN,                                                                                                         ");
		sql.append("         A.BANNAB_CONFIRM BANNAB_CONFIRM,                                                                                               ");
		sql.append("         A.SOURCE_FKOCS1003 SOURCE_ORD_KEY,                                                                                             ");
		sql.append("         A.OCS_FLAG OCS_FLAG,                                                                                                           ");
		sql.append("         A.SG_CODE SG_CODE,                                                                                                             ");
		sql.append("         A.SG_YMD SG_YMD,                                                                                                               ");
		sql.append("         A.IO_GUBUN IO_GUBUN,                                                                                                           ");
		sql.append("         A.AFTER_ACT_YN AFTER_ACT_YN,                                                                                                   ");
		sql.append("         A.BICHI_YN BICHI_YN,                                                                                                           ");
		sql.append("         A.DRG_BUNHO DRG_BUNHO,                                                                                                         ");
		sql.append("         A.SUB_SUSUL SUB_SUSUL,                                                                                                         ");
		sql.append("         A.PRINT_YN PRINT_YN,                                                                                                           ");
		sql.append("         A.CHISIK CHISIK,                                                                                                               ");
		sql.append("         A.TEL_YN TEL_YN,                                                                                                               ");
		sql.append("         B.ORDER_GUBUN ORDER_GUBUN_BAS,                                                                                                 ");
		sql.append("         B.INPUT_CONTROL INPUT_CONTROL,                                                                                                 ");
		sql.append("         B.SUGA_YN SUGA_YN,                                                                                                             ");
		sql.append("         B.JAERYO_YN JAERYO_YN,                                                                                                         ");
		sql.append("         IF(B.WONYOI_ORDER_YN = 'Z', 'Y', 'N') WONYOI_CHECK,                                                                            ");
		sql.append("         IF(IFNULL(B.EMERGENCY, 'Z') = 'Z', 'Y', IFNULL(B.EMERGENCY, 'Z')) EMERGENCY_CHECK,                                             ");
		sql.append("         B.SPECIMEN_YN SPECIMEN_CHECK,                                                                                                  ");
		sql.append("         B.PORTABLE_CHECK PORTABLE_CHECK,                                                                                               ");
		sql.append("         CASE                                                                                                                           ");
		sql.append("            WHEN (B.END_DATE IS NULL) THEN 'N'                                                                                          ");
		sql.append("            WHEN (B.END_DATE = DATE_FORMAT('99981231', '%Y%m%d')) THEN 'N'                                                              ");
		sql.append("            ELSE 'Y'                                                                                                                    ");
		sql.append("         END                                                                                                                            ");
		sql.append("            BULYONG_CHECK,                                                                                                              ");
		sql.append("         IF(A.SUNAB_DATE IS NULL, 'N', 'Y') SUNAB_CHECK,                                                                                ");
		sql.append("         IF(SIGN(A.NALSU) =  1 OR SIGN(A.NALSU) = 0, 'N',  'Y') DC_CHECK,                                                               ");
		sql.append("         A.DC_GUBUN DC_GUBUN_CHECK,                                                                                                     ");
		sql.append("         IF(A.NURSE_CONFIRM_DATE IS NULL, 'N', 'Y') CONFIRM_CHECK,                                                                      ");
		sql.append("         IF(A.RESER_DATE IS NULL, 'N', 'Y') RESER_YN_CHECK,                                                                             ");
		sql.append("         IF(A.CHISIK = '', 'N', 'Y') CHISIK_YN,                                                                                         ");
		sql.append("         A.NDAY_YN NDAY_YN,                                                                                                             ");
		sql.append("         FN_OCS_LOAD_JAERYO_JUNDAL_YN (:hospCode,'O', A.INPUT_PART, A.HANGMOG_CODE) DEFAULT_JAERYO_JUNDAL_YN,                           ");
		sql.append("         CASE                                                                                                                           ");
		sql.append("            WHEN (   A.ORDER_GUBUN NOT IN ('A', 'B', 'C', 'D')                                                                          ");
		sql.append("                  OR A.WONYOI_ORDER_YN = 'Z'                                                                                            ");
		sql.append("                  OR A.WONYOI_ORDER_YN = 'Y')                                                                                           ");
		sql.append("            THEN                                                                                                                        ");
		sql.append("               'N'                                                                                                                      ");
		sql.append("            ELSE                                                                                                                        ");
		sql.append("               'Y'                                                                                                                      ");
		sql.append("         END                                                                                                                            ");
		sql.append("            DEFAULT_WONYOI_YN,                                                                                                          ");
		sql.append("         D.SPECIFIC_COMMENT SPECIFIC_COMMENT,                                                                                           ");
		sql.append("         D.SPECIFIC_COMMENT_NAME SPECIFIC_COMMENT_NAME,                                                                                 ");
		sql.append("         D.SPECIFIC_COMMENT_SYS_ID SPECIFIC_COMMENT_SYS_ID,                                                                             ");
		sql.append("         D.SPECIFIC_COMMENT_PGM_ID SPECIFIC_COMMENT_PGM_ID,                                                                             ");
		sql.append("         D.SPECIFIC_COMMENT_NOT_NULL SPECIFIC_COMMENT_NOT_NULL,                                                                         ");
		sql.append("         D.SPECIFIC_COMMENT_TABLE_ID SPECIFIC_COMMENT_TABLE_ID,                                                                         ");
		sql.append("         D.SPECIFIC_COMMENT_COL_ID SPECIFIC_COMMENT_COL_ID,                                                                             ");
		sql.append("         FN_DRG_LOAD_DONBOK_YN (A.BOGYONG_CODE, :hospCode) DONBOG_YN,                                                                   ");
		sql.append("         FN_OCS_LOAD_CODE_NAME ('ORDER_GUBUN_BAS', SUBSTR(A.ORDER_GUBUN, 2, 1), :hospCode, :language) ORDER_GUBUN_BAS_NAME,             ");
		sql.append("         A.ACT_DOCTOR ACT_DOCTOR,                                                                                                       ");
		sql.append("         A.ACT_BUSEO ACT_BUSEO,                                                                                                         ");
		sql.append("         A.ACT_GWA ACT_GWA,                                                                                                             ");
		sql.append("         A.HOME_CARE_YN HOME_CARE_YN,                                                                                                   ");
		sql.append("         A.REGULAR_YN REGULAR_YN,                                                                                                       ");
		sql.append("         A.SORT_FKOCSKEY SORT_FKOCSKEY,                                                                                                 ");
		sql.append("         CASE                                                                                                                           ");
		sql.append("            WHEN (IF(A.BOM_SOURCE_KEY IS NULL, FN_OCS_LOAD_CHILD_GUBUN(A.HOSP_CODE, 'O', A.PKOCS1003C),                                  ");
		sql.append("                          '3') != '3') THEN 'N'                                                                                         ");
		sql.append("            ELSE 'Y'                                                                                                                    ");
		sql.append("         END                                                                                                                            ");
		sql.append("            CHILD_YN,                                                                                                                   ");
		sql.append("         B.IF_INPUT_CONTROL IF_INPUT_CONTROL,                                                                                           ");
		sql.append("         F.SLIP_NAME SLIP_NAME,                                                                                                         ");
		sql.append("         A.PKOCS1003C ORG_KEY,                                                                                                           ");
		sql.append("         A.BOM_SOURCE_KEY PARENT_KEY,                                                                                                   ");
		sql.append("         G.BUN_CODE BUN_CODE,                                                                                                           ");
		sql.append("         CASE                                                                                                                           ");
		sql.append("            WHEN (B.ORDER_GUBUN IN ('B', 'C', 'D'))                                                                                     ");
		sql.append("            THEN                                                                                                                        ");
		sql.append("               IFNULL(B.WONNAE_DRG_YN, 'N')                                                                                             ");
		sql.append("            ELSE                                                                                                                        ");
		sql.append("               '%'                                                                                                                      ");
		sql.append("         END                                                                                                                            ");
		sql.append("            WONNAE_DRG_YN,                                                                                                              ");
		sql.append("         ' ' HUBAL_CHANGE_CHECK,                                                                                                        ");
		sql.append("         ' ' DRG_PACK_CHECK,                                                                                                            ");
		sql.append("         ' ' PHARMACY_CHECK,                                                                                                            ");
		sql.append("         ' ' POWER_CHECK,                                                                                                               ");
		sql.append("         IFNULL(A.IMSI_DRUG_YN, 'N') IMSI_DRUG_YN,                                                                                      ");
		sql.append("         IFNULL(A.GENERAL_DISP_YN, 'N') GENERAL_DISP_YN,                                                                                ");
		sql.append("         A.DV_5 DV_5,                                                                                                                   ");
		sql.append("         A.DV_6 DV_6,                                                                                                                   ");
		sql.append("         A.DV_7 DV_7,                                                                                                                   ");
		sql.append("         A.DV_8 DV_8,                                                                                                                   ");
		sql.append("         A.BOGYONG_CODE_SUB BOGYONG_CODE_SUB,                                                                                           ");
		sql.append("         CASE                                                                                                                           ");
		sql.append("            WHEN (   SUBSTR(A.ORDER_GUBUN, 2) = 'A'                                                                                     ");
		sql.append("                  OR SUBSTR(A.ORDER_GUBUN, 2) = 'B'                                                                                     ");
		sql.append("                  OR SUBSTR(A.ORDER_GUBUN, 2) = 'D')                                                                                    ");
		sql.append("            THEN                                                                                                                        ");
		sql.append("               FN_CHT_LOAD_CHT0117_NAME(A.BOGYONG_CODE_SUB, :hospCode, :language)                                                       ");
		sql.append("            ELSE                                                                                                                        ");
		sql.append("               FN_DRG_LOAD_BOGYONG_NAME(A.BOGYONG_CODE_SUB, :hospCode)                                                                  ");
		sql.append("         END                                                                                                                            ");
		sql.append("            BOGYONG_NAME_SUB,                                                                                                           ");
		sql.append("         B.LIMIT_NALSU LIMIT_NALSU,                                                                                                     ");
		sql.append("         B.LIMIT_SURYANG LIMIT_SURYANG,                                                                                                 ");
		sql.append("         J.GWA_NAME GWA_NAME,                                                                                                           ");
		sql.append("         IFNULL(A.INSTEAD_YN, 'N') INSTEAD_YN,                                                                                          ");
		sql.append("         IFNULL(A.APPROVE_YN, 'N') APPROVE_YN,                                                                                          ");
		sql.append("         IFNULL(A.POSTAPPROVE_YN, 'N') POSTAPPROVE_YN,                                                                                  ");
		sql.append("         FN_OCS_LOAD_ORDER_SORT_KEY ('O', A.PKOCS1003C,:hospCode) ORDER_BY_KEY,                                                          ");
		sql.append("		 'N'	AS ACTION_DO_YN																											");
		sql.append("    FROM                                                                                                                                ");
		sql.append("         OCS1003C A                                                                                                                      ");
		sql.append("         LEFT JOIN OCS0116 C ON C.HOSP_CODE = A.HOSP_CODE AND C.SPECIMEN_CODE = A.SPECIMEN_CODE                                         ");
		sql.append("         INNER JOIN OUT1001 E ON E.HOSP_CODE = A.HOSP_CODE AND E.PKOUT1001 = A.FKOUT1001                                                ");
		sql.append("         INNER JOIN OCS0102 F ON F.HOSP_CODE = A.HOSP_CODE AND A.SLIP_CODE = F.SLIP_CODE                                                ");
		sql.append("         INNER JOIN BAS0260 J ON J.HOSP_CODE = A.HOSP_CODE AND J.GWA = A.JUNDAL_PART AND F.LANGUAGE = J.LANGUAGE  AND J.LANGUAGE = :language                        ");
		sql.append("         , OCS0103 B                                                                                                                    ");
		sql.append("         LEFT JOIN OCS0170 D ON D.HOSP_CODE = B.HOSP_CODE AND D.SPECIFIC_COMMENT = B.SPECIFIC_COMMENT                                   ");
		sql.append("         LEFT JOIN (SELECT A.SG_CODE,                                                                                                   ");
		sql.append("                 A.SG_NAME,                                                                                                             ");
		sql.append("                 A.BUN_CODE,                                                                                                            ");
		sql.append("                 A.HOSP_CODE                                                                                                            ");
		sql.append("            FROM BAS0310 A                                                                                                              ");
		sql.append("           WHERE A.HOSP_CODE = :hospCode                                                                                                ");
		sql.append("             AND A.SG_CODE IN (SELECT SG_CODE FROM OCS1003 WHERE HOSP_CODE = :hospCode AND BUNHO = :bunho AND FKOUT1001 = :fkout1001)   ");
		sql.append("             AND A.SG_YMD =                                                                                                             ");
		sql.append("                    (SELECT MAX(Z.SG_YMD)                                                                                               ");
		sql.append("                       FROM BAS0310 Z                                                                                                   ");
		sql.append("                      WHERE Z.HOSP_CODE = A.HOSP_CODE                                                                                   ");
		sql.append("                            AND Z.SG_CODE = A.SG_CODE																                    ");
		sql.append("                            AND Z.SG_YMD <= SYSDATE())) G ON G.HOSP_CODE = B.HOSP_CODE AND G.SG_CODE = B.SG_CODE                        ");
		sql.append(" LEFT JOIN ( select distinct A.HOSP_CODE AS HOSP_CODE ,A.HANGMOG_CODE AS HANGMOG_CODE, C.GENERIC_NAME AS GENERIC_NAME                   ");
		sql.append("               FROM OCS0109 C INNER JOIN OCS0110 B ON C.HOSP_CODE = B.HOSP_CODE AND C.GENERIC_CODE_ORG = B.GENERIC_CODE_ORG             ");
		sql.append("                              INNER JOIN OCS0103 A ON B.HOSP_CODE = A.HOSP_CODE AND B.YAK_KIJUN_CODE = A.YAK_KIJUN_CODE                 ");
		sql.append("         AND A.START_DATE <= SYSDATE() AND A.END_DATE >= SYSDATE()                                                                      ");
		sql.append(" AND A.START_DATE = (SELECT MAX(S.START_DATE) FROM OCS0103 S where S.HOSP_CODE = A.HOSP_CODE AND S.HANGMOG_CODE = A.HANGMOG_CODE)       ");
		sql.append("                              WHERE  B.HOSP_CODE = :hospCode                                                                            ");
		sql.append("            union all                                                                                                                   ");
		sql.append("            select distinct A.HOSP_CODE AS HOSP_CODE ,A.HANGMOG_CODE AS HANGMOG_CODE, C.GENERIC_NAME AS GENERIC_NAME                    ");
		sql.append("            FROM OCS0109 C INNER JOIN OCS0103 A ON C.HOSP_CODE = A.HOSP_CODE AND C.GENERIC_CODE = A.YAK_KIJUN_CODE_SHORT                ");
		sql.append("         AND A.START_DATE <= SYSDATE() AND A.END_DATE >= SYSDATE()                                                                      ");
		sql.append(" AND A.START_DATE = (SELECT MAX(S.START_DATE) FROM OCS0103 S where S.HOSP_CODE = A.HOSP_CODE AND S.HANGMOG_CODE = A.HANGMOG_CODE)       ");
		sql.append("            WHERE C.HOSP_CODE = :hospCode AND                                                                                           ");
		sql.append("                 (not (exists(SELECT NULL FROM OCS0110 Z                                                                                ");
		sql.append("                                WHERE Z.HOSP_CODE = A.HOSP_CODE AND                                                                     ");
		sql.append("                                Z.YAK_KIJUN_CODE = A.YAK_KIJUN_CODE)))) I                                                               ");
		sql.append("                           ON I.HOSP_CODE = B.HOSP_CODE AND I.HANGMOG_CODE = B.HANGMOG_CODE										    	");
		sql.append("   WHERE  A.HOSP_CODE = :hospCode                                                                                                       ");
		sql.append("         AND A.BUNHO = :bunho                                                                                                           ");
		sql.append("         AND A.FKOUT1001 = :fkout1001                                                                                                   ");
		sql.append("         AND (IFNULL(A.INSTEAD_YN, 'N') = 'N'                                                                                           ");
		sql.append("              OR (IFNULL(A.INSTEAD_YN, 'N') = 'Y'                                                                                       ");
		sql.append("                  AND IFNULL(A.APPROVE_YN, 'N') LIKE                                                                                    ");
		sql.append("                         IF(:queryGubun = 'Y', 'Y', '%')))                                                                              ");
		sql.append("         AND ( (:queryGubun = 'D' AND A.INPUT_GUBUN LIKE 'D%')                                                                          ");
		sql.append("              OR (:queryGubun != 'D'                                                                                                    ");
		sql.append("                  AND (A.INPUT_GUBUN LIKE 'D%'                                                                                          ");
		sql.append("                       OR A.INPUT_GUBUN = :inputGubun)))                                                                                ");
		sql.append("         AND B.HOSP_CODE = A.HOSP_CODE                                                                                                  ");
		sql.append("         AND B.HANGMOG_CODE = A.HANGMOG_CODE                                                                                            ");
		sql.append("         AND B.START_DATE <= SYSDATE() AND B.END_DATE >= SYSDATE()                                                                      ");
		sql.append(" AND B.START_DATE = (SELECT MAX(S.START_DATE) FROM OCS0103 S where S.HOSP_CODE = B.HOSP_CODE AND S.HANGMOG_CODE = B.HANGMOG_CODE)       ");
		sql.append("         AND A.ORDER_DATE BETWEEN B.START_DATE AND B.END_DATE                                                                           ");
		sql.append("         AND J.LANGUAGE = :language                                                                                                     ");
		sql.append("ORDER BY CASE WHEN ORDER_BY_KEY IS NULL THEN A.PKOCS1003C  ELSE ORDER_BY_KEY END                                                        ");
		
		Query query = entityManager.createNativeQuery(sql.toString());
		query.setParameter("hospCode", hospCode);
		query.setParameter("language", language);
		query.setParameter("bunho", bunho);
		query.setParameter("fkout1001", fkout1001);
		query.setParameter("queryGubun", queryGubun);
		query.setParameter("inputGubun", inputGubun);
		List<OcsoOCS1003P01LayoutQueryInfo> list = new JpaResultMapper().list(query, OcsoOCS1003P01LayoutQueryInfo.class);

		return list;
	}
	
	@Override
	public List<Ocs1003C> getByHospCodeAndFks0201(String hospCode, Double fksch0201) {
		StringBuilder sql = new StringBuilder();
		sql.append(" SELECT a  from Ocs1003C a , Sch0201 b  																							");
		sql.append(" WHERE a.hospCode  = :f_hosp_code and a.hospCode =  b.hospCode  AND  a.pkocs1003c   =  b.fkOcs1003c AND b.pksch0201   =:f_fksch0201 ");


		Query query = entityManager.createQuery(sql.toString());

		query.setParameter("f_hosp_code", hospCode);
		query.setParameter("f_fksch0201", fksch0201);


		return query.getResultList();
	}
}
